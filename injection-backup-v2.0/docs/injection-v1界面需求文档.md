# Injection工具 - 界面需求文档

## 1. 总体界面架构

### 1.1 主窗口布局
- **窗口类型**: 自定义标题栏的主窗口 (1200x700像素)
- **布局方式**: 三列式布局
  - 左侧：标签面板 (100px固定宽度)
  - 中左：场景管理面板 (200px固定宽度)  
  - 右侧：主操作面板 (剩余空间)
- **窗口特性**: 
  - 支持最大化/最小化
  - 支持拖拽移动
  - 支持系统托盘最小化
  - 自定义关闭/最小化/最大化按钮

### 1.2 自定义标题栏
- **高度**: 40px
- **背景**: 深色主题 (#2b2b2b)
- **组件布局**:
  - 左侧：窗口图标 + 应用名称
  - 右侧：最小化、最大化、关闭按钮
- **交互**: 
  - 双击标题栏可最大化/还原
  - 拖拽标题栏可移动窗口

## 2. 功能区域详细设计

### 2.1 标签面板 (左侧 100px)
```
[标签面板]
┌─────────────┐
│  [任务]     │ <- 绿色按钮 (#4CAF50)
│  [里程碑]   │ <- 蓝色按钮 (#2196F3)  
│  [问题]     │ <- 橙色按钮 (#FF9800)
└─────────────┘
```

**设计要求**:
- **按钮尺寸**: 80x40px
- **边距**: 上下10px间距
- **交互效果**: 
  - 悬停时颜色变暗 (factor=0.8)
  - 点击时颜色进一步加深 (factor=0.6)
- **功能**: 点击后在命令输入框中插入对应标签 `[任务]` `[里程碑]` `[问题]`

### 2.2 场景管理面板 (中左 200px)
```
[场景管理面板]
┌──────────────────┐
│ 场景列表         │
│ ├ ★自然模式      │ <- 默认场景用★标记
│ ├ 编程模式       │
│ ├ 写作模式       │
│ └ ...           │
│                  │
│ 版本列表         │ 
│ ├ ★默认模板      │ <- 默认版本用★标记
│ ├ 简化版本       │
│ └ ...           │
│                  │
│ [设为默认]       │ <- 按钮
│ [模板管理]       │ <- 按钮
└──────────────────┘
```

**设计要求**:
- **场景列表**: QListWidget，单选模式
- **版本列表**: QListWidget，单选模式  
- **默认标记**: 默认场景/版本前显示★符号
- **按钮样式**: 统一的QPushButton样式
- **交互逻辑**: 
  - 选择场景后自动加载对应版本列表
  - 点击"设为默认"保存当前选择为默认模板
  - 点击"模板管理"打开模板编辑对话框

### 2.3 主操作面板 (右侧)
```
[主操作面板]
┌─────────────────────────────────────┐
│ 工具栏                               │
│ [校准] [🎯拖拽] [Cascade] [API设置]  │
│                                     │
│ 命令输入区域                         │
│ ┌─────────────────────────────────┐ │
│ │ 多行文本输入框                   │ │
│ │ (支持拖拽、粘贴、快捷键)         │ │
│ │                                 │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 操作按钮区域                         │
│ [注入命令] [记录笔记] [清除文本]     │
│                                     │
│ 状态信息区域                         │
│ 目标窗口: [未检测] 鼠标位置: (x,y)   │
│                                     │
│ MD阅读面板 (可选显示)                 │
│ ┌─────────────────────────────────┐ │
│ │ Markdown渲染显示区域             │ │  
│ │ (显示日志文件内容)               │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

**工具栏设计**:
- **高度**: 40px
- **按钮尺寸**: 80x30px
- **按钮功能**:
  - `[校准]`: 鼠标位置校准功能
  - `[🎯拖拽]`: 脑图拖拽功能开关
  - `[Cascade]`: 从Cascade窗口捕获文本
  - `[API设置]`: 打开API配置对话框

**命令输入区域**:
- **控件**: QTextEdit多行文本框
- **高度**: 自适应，最小100px
- **功能**: 
  - 支持文本拖拽进入
  - 支持图片拖拽转换为文本
  - 支持Ctrl+V粘贴
  - 支持标签插入

**操作按钮区域**:
- **布局**: 水平排列
- **按钮尺寸**: 100x40px
- **样式**: 统一的QPushButton样式
- **功能**:
  - `[注入命令]`: 将命令注入目标应用
  - `[记录笔记]`: 将内容记录到日志文件
  - `[清除文本]`: 清空输入框内容

**状态信息区域**:
- **高度**: 30px
- **内容**: 显示目标窗口名称、鼠标位置等状态信息
- **样式**: 状态栏样式

**MD阅读面板**:
- **显示方式**: 可收起/展开
- **内容**: 渲染日志文件的Markdown内容
- **功能**: 
  - 自动刷新显示最新日志
  - 支持滚动到最新交互记录
  - 支持搜索功能

## 3. 对话框设计

### 3.1 模板管理对话框
```
[模板管理对话框] (600x400)
┌────────────────────────────────────┐
│ 模板管理                            │
│ ┌──────────┐ ┌─────────────────────┐│
│ │场景列表   │ │模板内容编辑区域      ││
│ │├自然模式  │ │前缀内容:            ││
│ │├编程模式  │ │┌─────────────────┐ ││
│ │└写作模式  │ ││                 │ ││
│ │          │ │└─────────────────┘ ││
│ │版本列表   │ │                    ││
│ │├默认模板  │ │后缀内容:            ││
│ │├简化版本  │ │┌─────────────────┐ ││
│ │└完整版本  │ ││                 │ ││
│ │          │ │└─────────────────┘ ││
│ └──────────┘ └─────────────────────┘│
│ [新建场景] [删除场景] [保存] [取消]   │
└────────────────────────────────────┘
```

### 3.2 API设置对话框
```
[API设置对话框] (400x200)
┌─────────────────────────────┐
│ API配置                      │
│ API密钥: ┌─────────────────┐ │
│          │[输入框]         │ │
│          └─────────────────┘ │
│ □ 自动保存                   │
│                             │
│      [保存] [取消]           │
└─────────────────────────────┘
```

### 3.3 校准进度对话框
```
[校准对话框] (300x150)
┌──────────────────────────┐
│ 鼠标位置校准              │
│                          │
│ 请点击目标窗口的输入区域   │
│                          │
│ ████████░░ 80%           │
│                          │
│     [取消校准]            │
└──────────────────────────┘
```

## 4. 视觉设计规范

### 4.1 主题色彩
```css
/* 主色调 */
主背景色: #f0f0f0
面板背景: #ffffff  
边框颜色: #e0e0e0
文字颜色: #333333

/* 按钮色彩 */
主按钮: #007acc
辅助按钮: #6c757d
成功按钮: #28a745
警告按钮: #ffc107
危险按钮: #dc3545

/* 标签色彩 */
任务标签: #4CAF50 (绿色)
里程碑标签: #2196F3 (蓝色)  
问题标签: #FF9800 (橙色)

/* 状态色彩 */
成功状态: #28a745
失败状态: #dc3545
警告状态: #ffc107
信息状态: #17a2b8
```

### 4.2 字体规范
- **主要字体**: Microsoft YaHei, 12px
- **标题字体**: Microsoft YaHei, 14px, Bold
- **状态文字**: Microsoft YaHei, 10px
- **代码字体**: Consolas, 11px (用于命令输入区域)

### 4.3 间距规范
- **面板间距**: 10px
- **组件边距**: 8px
- **按钮间距**: 5px
- **文字行高**: 1.4

## 5. 交互设计要求

### 5.1 快捷键支持
- **Ctrl+Enter**: 注入命令
- **Ctrl+N**: 记录笔记  
- **Ctrl+L**: 清除文本
- **Ctrl+D**: 开始校准
- **Ctrl+T**: 切换主题
- **Ctrl+R**: 刷新项目信息
- **F1**: 显示帮助

### 5.2 拖拽支持
- **文本拖拽**: 支持从其他应用拖拽文本到输入框
- **图片拖拽**: 支持图片拖拽，自动转换为描述文本
- **文件拖拽**: 支持文件拖拽，读取文件内容

### 5.3 右键菜单
- **输入框右键菜单**: 
  - 复制
  - 粘贴  
  - 剪切
  - 全选
  - 插入时间戳
  - 插入标签

### 5.4 状态反馈
- **操作成功**: 绿色mini通知气泡，2秒后自动消失
- **操作失败**: 红色mini通知气泡，显示错误信息
- **正在处理**: 按钮显示加载状态，禁用重复点击

### 5.5 窗口行为
- **关闭行为**: 最小化到托盘，不退出程序
- **托盘交互**: 
  - 单击托盘图标显示/隐藏窗口
  - 右键托盘图标显示菜单(显示/隐藏、退出)
- **窗口记忆**: 记住窗口位置和大小

## 6. 响应式设计

### 6.1 最小窗口尺寸
- **最小宽度**: 800px
- **最小高度**: 600px
- **标签面板**: 固定100px宽度
- **场景面板**: 固定200px宽度
- **主操作面板**: 自适应剩余空间

### 6.2 组件自适应
- **命令输入框**: 随窗口高度自适应
- **MD阅读面板**: 可收起以节省空间
- **按钮布局**: 窗口过窄时自动换行

## 7. 无障碍设计

### 7.1 键盘导航
- 支持Tab键在控件间切换
- 支持Enter键激活按钮
- 支持方向键在列表中导航

### 7.2 提示信息
- 重要按钮提供tooltip提示
- 状态信息清晰易懂
- 错误信息具体明确

## 8. 动画效果

### 8.1 界面切换
- **面板展开/收起**: 300ms缓动动画
- **按钮悬停**: 100ms颜色过渡
- **通知显示**: 淡入淡出效果

### 8.2 状态指示
- **校准进度**: 进度条动画
- **加载状态**: 旋转loading图标
- **成功/失败**: 颜色闪烁提示

## 9. 性能要求

### 9.1 响应速度
- **界面启动**: 2秒内完成加载
- **按钮响应**: 100ms内响应点击
- **文本输入**: 无明显延迟

### 9.2 内存使用
- **基础内存占用**: < 50MB
- **最大内存占用**: < 200MB
- **内存泄漏**: 长时间运行无明显增长

## 10. 兼容性要求

### 10.1 操作系统
- **主要支持**: Windows 10/11
- **次要支持**: Windows 7/8.1
- **屏幕分辨率**: 1920x1080及以上

### 10.2 依赖环境
- **Python版本**: 3.8+
- **PyQt版本**: 5.15+
- **其他依赖**: 见requirements.txt 