<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jsMind æœ¬åœ°ç‰ˆæ¼”ç¤ºï¼ˆæ”¯æŒæ‹–æ‹½åŠŸèƒ½ï¼‰</title>
    <!-- å¼•å…¥æœ¬åœ°å®‰è£…çš„ jsMind -->
    <link type="text/css" rel="stylesheet" href="./node_modules/jsmind/style/jsmind.css" />
    <script type="text/javascript" src="./node_modules/jsmind/es6/jsmind.js"></script>
    <!-- å¼•å…¥æœ¬åœ°æ‹–æ‹½åŠŸèƒ½æ’ä»¶ -->
    <script type="text/javascript" src="./node_modules/jsmind/es6/jsmind.draggable-node.js"></script>
    <!-- å¼•å…¥æˆªå›¾å¯¼å‡ºåŠŸèƒ½ä¾èµ– -->
    <script src="https://unpkg.com/dom-to-image@2.6.0/dist/dom-to-image.min.js"></script>
    <script type="text/javascript" src="./node_modules/jsmind/es6/jsmind.screenshot.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 5px;
            text-align: center;
            min-height: 20px;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .header .subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin: 0 0 15px 0;
        }
        
        .feature-highlight {
            background: rgba(255,255,255,0.1);
            padding: 12px 18px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .toolbar {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid #dee2e6;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #1e7e34; }
        
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-warning:hover { background: #e0a800; }
        
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #545b62; }
        
        .btn-info { background: #17a2b8; }
        .btn-info:hover { background: #138496; }
        
        #jsmind_container {
            height: calc(100vh - 200px);
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        
        .main-layout {
            display: flex;
            height: calc(100vh - 200px);
            gap: 20px;
            margin: 20px;
        }
        
        .details-panel {
            width: 380px;
            background: rgba(255,255,255,0.95);
            border-radius: 8px;
            border: 1px solid #e3f2fd;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            flex-shrink: 0;
            height: calc(100vh - 180px);
        }
        
        .details-header {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            font-size: 16px;
        }
        
        .details-content {
            padding: 20px;
            height: calc(100% - 60px);
            overflow-y: auto;
        }
        
        .mindmap-container {
            flex: 1;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .placeholder-content {
            text-align: center;
            color: #6c757d;
            padding: 40px 20px;
            border: 2px dashed #dee2e6;
            border-radius: 6px;
            background: #f8f9fa;
            margin-bottom: 20px;
        }
        
        .placeholder-content .icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .placeholder-content .title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .placeholder-content .subtitle {
            font-size: 14px;
            opacity: 0.7;
        }
        
        .main-content {
            margin: 20px 0;
        }
        
        .node-info-panel {
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: fit-content;
            max-height: 650px;
            overflow-y: auto;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
            background: #e9ecef;
            border-radius: 8px 8px 0 0;
        }
        
        .panel-header h3 {
            margin: 0;
            font-size: 16px;
            color: #495057;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 20px;
            color: #6c757d;
            cursor: pointer;
        }
        
        .close-btn:hover {
            color: #343a40;
        }
        
        .panel-content {
            padding: 10px 0;
        }
        
        /* èŠ‚ç‚¹è¯¦æƒ…é¢æ¿åœ¨æ“ä½œæŒ‡å—åŒºåŸŸå†…çš„æ ·å¼ */
        .help-item.node-details .panel-content {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px 0;
        }
        
        .help-item.node-details .node-detail-form {
            margin-top: 10px;
        }
        
        .placeholder {
            color: #586069;
            font-style: italic;
            text-align: center;
            padding: 15px 0;
        }
        
        .node-info-item {
            margin-bottom: 12px;
        }
        
        .node-info-item label {
            display: block;
            font-weight: 600;
            font-size: 13px;
            color: #495057;
            margin-bottom: 4px;
        }
        
        .node-info-item .value {
            font-size: 14px;
            word-break: break-word;
        }
        
        .node-info-item .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .node-info-item .tag {
            background: #e9ecef;
            color: #495057;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .node-path {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #dee2e6;
        }
        
        .node-path span {
            color: #007bff;
        }
        
        /* è¡¨å•æ ·å¼ */
        .node-detail-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 14px;
            color: #495057;
            transition: border-color 0.2s ease;
        }
        
        .form-input:focus, .form-textarea:focus {
            border-color: #80bdff;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-start;
            gap: 10px;
            margin-top: 15px;
        }
        
        .form-btn {
            padding: 8px 16px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: #f8f9fa;
            color: #495057;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .form-btn:hover {
            background: #e9ecef;
        }
        
        .form-btn-primary {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .form-btn-primary:hover {
            background: #0069d9;
            border-color: #0062cc;
        }
        
        /* æ ‡ç­¾æ ·å¼ */
        .tags-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .tag {
            background: #e9ecef;
            color: #495057;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .tag a {
            color: #6c757d;
            text-decoration: none;
            font-weight: bold;
        }
        
        .tag a:hover {
            color: #dc3545;
        }
        
        .tag-input {
            padding: 5px 10px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 12px;
            width: 100%;
        }
        
        .relation-info, .time-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .drag-hint {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            margin: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
        }
        
        .drag-hint strong {
            color: #d63384;
        }
        
        .status {
            background: linear-gradient(135deg, #343a40 0%, #495057 100%);
            color: white;
            padding: 12px 20px;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
        }
        
        .help {
            padding: 25px;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
        }
        
        .help h3 {
            margin: 0 0 20px 0;
            color: #1565c0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .help-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .help-item {
            background: rgba(255,255,255,0.9);
            padding: 18px;
            border-radius: 8px;
            border-left: 4px solid;
        }
        
        .help-item.mouse { border-left-color: #007bff; }
        .help-item.keyboard { border-left-color: #28a745; }
        .help-item.drag { border-left-color: #fd7e14; }
        .help-item.features { border-left-color: #6f42c1; }
        
        .help-item h4 {
            margin: 0 0 12px 0;
            color: #2c3e50;
            font-size: 15px;
            font-weight: 600;
        }
        
        .help-item ul {
            margin: 0;
            padding-left: 20px;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .help-item li {
            margin: 6px 0;
        }
        
        @media (max-width: 768px) {
            .toolbar {
                padding: 15px;
                gap: 8px;
            }
            
            .btn {
                padding: 8px 14px;
                font-size: 13px;
            }
            
            .main-layout {
                flex-direction: column;
                height: auto;
                gap: 15px;
                margin: 15px;
            }
            
            .details-panel {
                width: 100%;
                order: 2;
            }
            
            .mindmap-container {
                order: 1;
                height: 400px;
            }
            
            #jsmind_container {
                height: 400px;
            }
        }
        
        /* è„‘å›¾é€‰é¡¹å¡æ ·å¼ */
        .mindmap-tab-container {
            height: 100%;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .mindmap-tab-header {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            flex-shrink: 0;
        }
        
        .mindmap-tab-button {
            flex: 1;
            padding: 12px 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
            position: relative;
            border-right: 1px solid #dee2e6;
        }
        
        .mindmap-tab-button:last-child {
            border-right: none;
        }
        
        .mindmap-tab-button:hover {
            background: #e9ecef;
            color: #495057;
        }
        
        .mindmap-tab-button.active {
            background: white;
            color: #007bff;
            font-weight: 600;
        }
        
        .mindmap-tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #007bff;
        }
        
        .mindmap-tab-content {
            display: none;
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        .mindmap-tab-content.active {
            display: block;
        }
        
        .jsmind-tab-canvas {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        /* å³é”®èœå•æ ·å¼ */
        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            padding: 5px 0;
            z-index: 10000;
            display: none;
        }
        
        .context-menu-item {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            white-space: nowrap;
        }
        
        .context-menu-item:hover {
            background: #f0f0f0;
        }
        
        .context-menu-divider {
            height: 1px;
            background: #eee;
            margin: 5px 0;
        }
        
        /* è¯¦æƒ…é¡µé€‰é¡¹å¡æ ·å¼ */
        .tab-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .tab-header {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            flex-shrink: 0;
        }
        
        .tab-button {
            flex: 1;
            padding: 12px 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
            position: relative;
            border-right: 1px solid #dee2e6;
        }
        
        .tab-button:last-child {
            border-right: none;
        }
        
        .tab-button:hover {
            background: #e9ecef;
            color: #495057;
        }
        
        .tab-button.active {
            background: white;
            color: #007bff;
            font-weight: 600;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #007bff;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-pane h4 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 16px;
            font-weight: 600;
        }
        
        .info-row {
            display: flex;
            margin-bottom: 12px;
            align-items: flex-start;
        }
        
        .info-label {
            min-width: 80px;
            font-weight: 600;
            color: #6c757d;
            font-size: 13px;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .info-value {
            flex: 1;
            font-size: 14px;
            color: #495057;
            word-break: break-word;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: #495057;
            font-size: 13px;
            margin-bottom: 6px;
        }
        
        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .form-textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            min-height: 320px;
            resize: vertical;
            box-sizing: border-box;
        }
        
        .detail-header {
            position: relative;
            margin-bottom: 15px;
        }
        
        .author-input-small {
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            padding: 4px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 12px;
            background: #f8f9fa;
        }
        
        .tag-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .tag-input {
            flex: 1;
            padding: 6px 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .tag-add-btn {
            padding: 6px 12px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }
        
        .tag-item {
            background: #e9ecef;
            color: #495057;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .tag-remove {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            font-size: 14px;
            padding: 0;
            margin-left: 4px;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }
        
        .btn-primary {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: 1px solid #007bff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-secondary {
            padding: 8px 16px;
            background: #6c757d;
            color: white;
            border: 1px solid #6c757d;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .history-item {
            padding: 12px;
            border-left: 3px solid #007bff;
            background: #f8f9fa;
            margin-bottom: 10px;
            border-radius: 0 4px 4px 0;
        }
        
        .history-time {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 4px;
        }
        
        .history-action {
            font-weight: 600;
            color: #495057;
            margin-bottom: 2px;
        }
        
        .history-detail {
            font-size: 13px;
            color: #6c757d;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }
        
        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .path-breadcrumb {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 15px;
        }
        
        .path-breadcrumb .path-separator {
            margin: 0 8px;
            color: #adb5bd;
        }
        
        .path-breadcrumb .path-node {
            color: #007bff;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <!-- ä¿ç•™åŒºåŸŸå¤‡ç”¨ -->
        </div>
        
        <div class="toolbar">
            <!-- éšè—çš„æ–‡ä»¶è¾“å…¥å…ƒç´  -->
            <input type="file" id="import_file_input" accept=".json,.jm,.mm" style="display: none;" onchange="handleFileImport(this)">
            
            <button class="btn btn-primary" onclick="showUserGuide()" style="background: #007bff; border: 2px solid #0056b3; font-size: 16px; font-weight: 600; padding: 12px 24px; box-shadow: 0 4px 12px rgba(0,123,255,0.3); transition: all 0.3s ease;">
                ğŸ“š ä½¿ç”¨æŒ‡å—
            </button>
            <button class="btn btn-secondary" onclick="exportToFile()">
                ğŸ’¾ å¯¼å‡ºJSONæ–‡ä»¶
            </button>
            <button class="btn btn-info" onclick="exportToCustomFile()">
                ğŸ“ è‡ªå®šä¹‰å¯¼å‡º
            </button>
            <button class="btn btn-warning" onclick="quickExport()">
                âš¡ å¿«é€Ÿå¯¼å‡º
            </button>
            <button class="btn btn-success" onclick="triggerImport()">
                ğŸ“‚ å¯¼å…¥æ–‡ä»¶
            </button>
            <button class="btn btn-danger" onclick="clearSavedData()">
                ğŸ—‘ï¸ æ¸…é™¤å­˜å‚¨
            </button>
            <button class="btn" onclick="toggleDrag()">
                ğŸ”€ <span id="dragStatus">ç¦ç”¨æ‹–æ‹½</span>
            </button>
            <button class="btn btn-primary" onclick="createNewContent()">
                âœ¨ æ–°å†…å®¹
            </button>
        </div>
        

        
        <div class="main-layout">
            <div class="mindmap-container">
                <div class="mindmap-tab-container">
                    <div class="mindmap-tab-header">
                        <button class="mindmap-tab-button" onclick="switchMindmapTab('workspace')">
                            ğŸ”¬ ä¸´æ—¶å·¥ä½œåŒºA
                        </button>
                        <button class="mindmap-tab-button" onclick="switchMindmapTab('knowledge')">
                            ğŸ“‹ ä¸´æ—¶å·¥ä½œåŒºB
                        </button>
                        <button class="mindmap-tab-button active" onclick="switchMindmapTab('project')">
                            ğŸš€ é¡¹ç›®ç®¡ç†
                        </button>
                    </div>
                    
                    <!-- ä¸´æ—¶å·¥ä½œåŒºAé€‰é¡¹å¡ -->
                    <div id="mindmap-tab-workspace" class="mindmap-tab-content">
                        <div id="jsmind_container_workspace" class="jsmind-tab-canvas"></div>
                    </div>
                    
                    <!-- ä¸´æ—¶å·¥ä½œåŒºBé€‰é¡¹å¡ -->
                    <div id="mindmap-tab-knowledge" class="mindmap-tab-content">
                        <div id="jsmind_container_knowledge" class="jsmind-tab-canvas"></div>
                    </div>
                    
                    <!-- é¡¹ç›®ç®¡ç†è„‘å›¾é€‰é¡¹å¡ï¼ˆä¸»æ˜¾ç¤ºåŒºï¼‰ -->
                    <div id="mindmap-tab-project" class="mindmap-tab-content active">
                        <div id="jsmind_container_project" class="jsmind-tab-canvas"></div>
                    </div>
                </div>
            </div>
            <div class="details-panel">
                <div class="tab-container">
                    <div class="tab-header">
                        <button class="tab-button active" onclick="switchTab('detail')">
                            ğŸ“ è¯¦ç»†æè¿°
                        </button>
                        <button class="tab-button" onclick="switchTab('basic')">
                            ğŸ“‹ åŸºæœ¬ä¿¡æ¯
                        </button>
                        <button class="tab-button" onclick="switchTab('history')">
                            ğŸ“š å†å²è®°å½•
                        </button>
                    </div>
                    
                    <!-- è¯¦ç»†æè¿°é€‰é¡¹å¡ -->
                    <div id="tab-detail" class="tab-content active">
                        <div id="detail-info-content">
                            <div class="empty-state">
                                <div class="icon">ğŸ“</div>
                                <div>ç‚¹å‡»æ€ç»´å¯¼å›¾ä¸­çš„èŠ‚ç‚¹ç¼–è¾‘è¯¦ç»†æè¿°</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- åŸºæœ¬ä¿¡æ¯é€‰é¡¹å¡ -->
                    <div id="tab-basic" class="tab-content">
                        <div id="basic-info-content">
                            <div class="empty-state">
                                <div class="icon">ğŸ“‹</div>
                                <div>ç‚¹å‡»æ€ç»´å¯¼å›¾ä¸­çš„èŠ‚ç‚¹æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å†å²è®°å½•é€‰é¡¹å¡ -->
                    <div id="tab-history" class="tab-content">
                        <div id="history-info-content">
                            <div class="empty-state">
                                <div class="icon">ğŸ“š</div>
                                <div>ç‚¹å‡»æ€ç»´å¯¼å›¾ä¸­çš„èŠ‚ç‚¹æŸ¥çœ‹å†å²è®°å½•</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="status">
            <div class="status-item">
                <div class="status-indicator"></div>
                <span>jsMind æœ¬åœ°ç‰ˆæœ¬å·²åŠ è½½</span>
            </div>
            <div class="status-item">
                å½“å‰ä¸»é¢˜: <span id="currentTheme">primary</span>
            </div>
            <div class="status-item">
                é€‰ä¸­èŠ‚ç‚¹: <span id="selectedNode">æ— </span>
            </div>
            <div class="status-item">
                æ‹–æ‹½çŠ¶æ€: <span id="dragEnabled">å·²å¯ç”¨</span>
            </div>
        </div>
        
        <div class="help">
            <h3>ğŸ“– å®Œæ•´æ“ä½œæŒ‡å—</h3>
            <div class="help-grid">
                <div class="help-item mouse">
                    <h4>ğŸ‘›ï¸ é¼ æ ‡æ“ä½œ</h4>
                    <ul>
                        <li>å•å‡»èŠ‚ç‚¹é€‰ä¸­</li>
                        <li>åŒå‡»èŠ‚ç‚¹ç¼–è¾‘å†…å®¹</li>
                        <li>æ‹–æ‹½ç”»å¸ƒç§»åŠ¨è§†å›¾</li>
                        <li>æ»šè½®ç¼©æ”¾æ€ç»´å¯¼å›¾</li>
                        <li><strong>æ‹–æ‹½èŠ‚ç‚¹é‡æ–°ç»„ç»‡ç»“æ„</strong></li>
                    </ul>
                </div>
                <div class="help-item keyboard">
                    <h4>âŒ¨ï¸ å¿«æ·é”®</h4>
                    <ul>
                        <li>Ctrl+Enter - æ·»åŠ å­èŠ‚ç‚¹</li>
                        <li>Enter - æ·»åŠ å…„å¼ŸèŠ‚ç‚¹</li>
                        <li>F2 - ç¼–è¾‘èŠ‚ç‚¹</li>
                        <li>Delete - åˆ é™¤èŠ‚ç‚¹</li>
                        <li>Space - å±•å¼€/æ”¶èµ·èŠ‚ç‚¹</li>
                        <li>æ–¹å‘é”® - é€‰æ‹©ç›¸é‚»èŠ‚ç‚¹</li>
                        <li><strong>Ctrl+S - å¯¼å‡ºå®Œæ•´JSONæ–‡ä»¶</strong></li>
                        <li><strong>Ctrl+E - è‡ªå®šä¹‰æ–‡ä»¶åå¯¼å‡º</strong></li>
                        <li><strong>Ctrl+Q - å¿«é€Ÿå¯¼å‡º</strong></li>
                        <li><strong>Ctrl+O - å¯¼å…¥æ–‡ä»¶</strong></li>
                    </ul>
                </div>
                <div class="help-item drag">
                    <h4>ğŸ”€ æ‹–æ‹½åŠŸèƒ½è¯¦è§£</h4>
                    <ul>
                        <li>æŒ‰ä½é¼ æ ‡å·¦é”®å¼€å§‹æ‹–æ‹½</li>
                        <li>æ‹–æ‹½åˆ°ç›®æ ‡èŠ‚ç‚¹ä¸Šæ–¹</li>
                        <li>é‡Šæ”¾é¼ æ ‡å®Œæˆç§»åŠ¨</li>
                        <li>æ”¯æŒè·¨åˆ†æ”¯æ‹–æ‹½ç§»åŠ¨</li>
                        <li>å¯å¼€å¯/å…³é—­æ‹–æ‹½åŠŸèƒ½</li>
                        <li>è‡ªåŠ¨é‡æ–°æ’åˆ—å¸ƒå±€</li>
                    </ul>
                </div>
                <div class="help-item features">
                    <h4>ğŸ¨ é«˜çº§åŠŸèƒ½</h4>
                    <ul>
                        <li>15ç§å†…ç½®ä¸»é¢˜</li>
                        <li>è‡ªå®šä¹‰èŠ‚ç‚¹æ ·å¼</li>
                        <li><strong>æœ¬åœ°æ–‡ä»¶å¯¼å‡º (Ctrl+S/E/Q)</strong></li>
                        <li><strong>æœ¬åœ°æ–‡ä»¶å¯¼å…¥ (Ctrl+O)</strong></li>
                        <li><strong>è‡ªåŠ¨æŒä¹…åŒ–å­˜å‚¨</strong></li>
                        <li>è‡ªå®šä¹‰æ–‡ä»¶åæ”¯æŒ</li>
                        <li>èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯å¯¼å‡º</li>
                        <li>å¤šæ ¼å¼æ–‡ä»¶å¯¼å…¥ (JSON/JM/MM)</li>
                        <li>é¡µé¢å…³é—­æ•°æ®ä¿æŠ¤</li>
                        <li>ç§»åŠ¨ç«¯æ”¯æŒ</li>
                        <li>å¿«æ·é”®æ“ä½œ</li>
                        <li>å®æ—¶çŠ¶æ€åé¦ˆ</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- å³é”®èœå• -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" onclick="focusNodeToWorkspaces()">
            ğŸ”¬ å•ç‹¬æ˜¾ç¤ºåˆ°ä¸´æ—¶å·¥ä½œåŒº
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" onclick="hideContextMenu()">
            âŒ å–æ¶ˆ
        </div>
    </div>

    <script type="text/javascript">
        // æ€ç»´å¯¼å›¾æ•°æ®
        var mindData = {
            meta: {
                name: "jsMindæœ¬åœ°æ‹–æ‹½æ¼”ç¤º",
                author: "NodeMind Demo",
                version: "1.0.0"
            },
            format: "node_tree",
            data: {
                id: "root",
                topic: "ğŸ§  jsMind æœ¬åœ°æ‹–æ‹½æ¼”ç¤º",
                children: [
                    {
                        id: "features",
                        topic: "ğŸš€ æ ¸å¿ƒç‰¹æ€§",
                        direction: "right",
                        children: [
                            { id: "feature1", topic: "çº¯JavaScriptå®ç°" },
                            { id: "feature2", topic: "HTML5 Canvasæ¸²æŸ“" },
                            { id: "feature3", topic: "èŠ‚ç‚¹æ‹–æ‹½åŠŸèƒ½" },
                            { id: "feature4", topic: "æœ¬åœ°åº“æ–‡ä»¶æ”¯æŒ" }
                        ]
                    },
                    {
                        id: "drag_features",
                        topic: "ğŸ”€ æ‹–æ‹½ç‰¹æ€§",
                        direction: "right",
                        children: [
                            { id: "drag1", topic: "æ‹–æ‹½èŠ‚ç‚¹ç§»åŠ¨" },
                            { id: "drag2", topic: "è·¨åˆ†æ”¯é‡ç»„" },
                            { id: "drag3", topic: "å®æ—¶è§†è§‰åé¦ˆ" },
                            { id: "drag4", topic: "è‡ªåŠ¨å¸ƒå±€è°ƒæ•´" }
                        ]
                    },
                    {
                        id: "applications",
                        topic: "ğŸ“‹ åº”ç”¨åœºæ™¯",
                        direction: "right",
                        children: [
                            { id: "app1", topic: "çŸ¥è¯†ç®¡ç†" },
                            { id: "app2", topic: "é¡¹ç›®è§„åˆ’" },
                            { id: "app3", topic: "å­¦ä¹ ç¬”è®°" },
                            { id: "app4", topic: "å›¢é˜Ÿåä½œ" }
                        ]
                    },
                    {
                        id: "advantages",
                        topic: "â­ æŠ€æœ¯ä¼˜åŠ¿",
                        direction: "right",
                        children: [
                            { id: "adv1", topic: "ç¦»çº¿ä½¿ç”¨" },
                            { id: "adv2", topic: "é«˜æ€§èƒ½æ¸²æŸ“" },
                            { id: "adv3", topic: "æ˜“äºé›†æˆ" },
                            { id: "adv4", topic: "å¼€æºå…è´¹" }
                        ]
                    }
                ]
            }
        };

        // ä¸‰ä¸ªè„‘å›¾å®ä¾‹
        var mindmaps = {
            workspace: null,
            knowledge: null,
            project: null
        };
        
        // å½“å‰æ´»è·ƒçš„è„‘å›¾ï¼ˆé¡¹ç›®ç®¡ç†ä¸ºä¸»æ˜¾ç¤ºåŒºï¼‰
        var currentMindmap = 'project';
        
        // è·å–å½“å‰æ´»è·ƒçš„jsMindå®ä¾‹
        function getCurrentJsMind() {
            return mindmaps[currentMindmap];
        }
        
        // å½“å‰å³é”®é€‰ä¸­çš„èŠ‚ç‚¹
        var contextMenuTargetNode = null;
        
        // ä¸‰ä¸ªè„‘å›¾çš„åˆå§‹æ•°æ®
        var mindmapData = {
            workspace: {
                meta: {
                    name: "ä¸´æ—¶å·¥ä½œåŒºA",
                    author: "NodeMind",
                    version: "1.0.0"
                },
                format: "node_tree",
                data: {
                    id: "workspace_root",
                    topic: "ğŸ”¬ ä¸´æ—¶å·¥ä½œåŒºA",
                    children: []
                }
            },
            knowledge: {
                meta: {
                    name: "ä¸´æ—¶å·¥ä½œåŒºB",
                    author: "NodeMind",
                    version: "1.0.0"
                },
                format: "node_tree",
                data: {
                    id: "knowledge_root",
                    topic: "ğŸ“‹ ä¸´æ—¶å·¥ä½œåŒºB",
                    children: []
                }
            },
            project: {
                meta: {
                    name: "é¡¹ç›®ç®¡ç†",
                    author: "NodeMind",
                    version: "1.0.0"
                },
                format: "node_tree",
                data: {
                    id: "project_root",
                    topic: "ğŸš€ é¡¹ç›®ç®¡ç†",
                    children: [
                        { id: "pj_1", topic: "éœ€æ±‚åˆ†æ", direction: "right" },
                        { id: "pj_2", topic: "è®¾è®¡é˜¶æ®µ", direction: "right" },
                        { id: "pj_3", topic: "å¼€å‘å®æ–½", direction: "left" },
                        { id: "pj_4", topic: "æµ‹è¯•éƒ¨ç½²", direction: "left" }
                    ]
                }
            }
        };
        
        // é…ç½®é€‰é¡¹ï¼Œå¯ç”¨æ‹–æ‹½åŠŸèƒ½
        var baseOptions = {
            editable: true,
            theme: 'primary',
            view: {
                engine: 'canvas',
                hmargin: 120,
                vmargin: 60,
                line_width: 2,
                line_color: '#566'
            },
            layout: {
                hspace: 30,
                vspace: 20,
                pspace: 13
            },
            shortcut: {
                enable: true,
                handles: {},
                mapping: {
                    addchild: 4096 + 13,  // Ctrl+Enter æ·»åŠ å­èŠ‚ç‚¹
                    addbrother: 13,  // Enter
                    editnode: 113,   // F2
                    delnode: 46,     // Delete
                    toggle: 32,      // Space
                    left: 37, up: 38, right: 39, down: 40
                }
            }
        };

        // åˆå§‹åŒ–èŠ‚ç‚¹æ•°æ®åº“
        var nodeDatabase = {};
        
        // é€’å½’éå†æ€ç»´å¯¼å›¾æ•°æ®ï¼Œåˆå§‹åŒ–èŠ‚ç‚¹æ•°æ®åº“
        function initNodeDatabase() {
            // ä¸ºæ‰€æœ‰å·¥ä½œåŒºåˆå§‹åŒ–èŠ‚ç‚¹æ•°æ®åº“
            Object.keys(mindmaps).forEach(function(tabName) {
                var mindmap = mindmaps[tabName];
                if (mindmap) {
                    var data = mindmap.get_data();
                    if (data && data.data) {
                        var rootNode = mindmap.get_node(data.data.id);
                        if (rootNode) {
                            traverseNode(rootNode);
                        }
                    }
                }
            });
            console.log('æ‰€æœ‰å·¥ä½œåŒºèŠ‚ç‚¹æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ:', nodeDatabase);
        }
        
        // éå†èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹
        function traverseNode(node) {
            if (!node) return;
            
            // åˆ›å»ºèŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯
            nodeDatabase[node.id] = {
                id: node.id,
                title: node.topic,
                content: '',
                relations: {
                    parent: node.parent ? node.parent.id : null,
                    children: node.children ? node.children.map(child => child.id) : []
                },
                tags: {
                    categories: [],
                    technical: [],
                    status: []
                },
                time: {
                    created: new Date().toLocaleString(),
                    modified: new Date().toLocaleString()
                },
                author: ''
            };
            
            // é€’å½’éå†å­èŠ‚ç‚¹
            if (node.children) {
                node.children.forEach(child => traverseNode(child));
            }
        }
        
        // åˆ›å»ºä¸‰ä¸ªjsMindå®ä¾‹
        function initMindmaps() {
            // åˆ›å»ºå·¥ä½œç©ºé—´è„‘å›¾
            mindmaps.workspace = new jsMind({
                ...baseOptions,
                container: 'jsmind_container_workspace'
            });
            mindmaps.workspace.show(mindmapData.workspace);
            
            // åˆ›å»ºçŸ¥è¯†åº“è„‘å›¾
            mindmaps.knowledge = new jsMind({
                ...baseOptions,
                container: 'jsmind_container_knowledge'
            });
            mindmaps.knowledge.show(mindmapData.knowledge);
            
            // åˆ›å»ºé¡¹ç›®ç®¡ç†è„‘å›¾
            mindmaps.project = new jsMind({
                ...baseOptions,
                container: 'jsmind_container_project'
            });
            mindmaps.project.show(mindmapData.project);
            
            // å¯ç”¨æ‹–æ‹½åŠŸèƒ½ - ä¸ºæ‰€æœ‰å®ä¾‹
            Object.values(mindmaps).forEach((mindmap, index) => {
                try {
                    if (typeof mindmap.enable_draggable_node === 'function') {
                        mindmap.enable_draggable_node();
                        console.log(`âœ… è„‘å›¾${index + 1}æ‹–æ‹½åŠŸèƒ½å·²å¯ç”¨`);
                    } else {
                        console.log(`âš ï¸ è„‘å›¾${index + 1}æ‹–æ‹½åŠŸèƒ½ä¸æ”¯æŒï¼ˆjsMindç‰ˆæœ¬é—®é¢˜ï¼‰`);
                    }
                } catch (dragError) {
                    console.log(`âš ï¸ è„‘å›¾${index + 1}æ‹–æ‹½åŠŸèƒ½å¯ç”¨å¤±è´¥:`, dragError.message);
                }
            });
        }
        
        // åˆå§‹åŒ–æ‰€æœ‰è„‘å›¾
        initMindmaps();
        
        // è·å–å½“å‰æ´»è·ƒçš„jsMindå®ä¾‹ï¼ˆå…¼å®¹åŸæœ‰ä»£ç ï¼‰
        var jm = getCurrentJsMind();
        
        // åˆå§‹åŒ–èŠ‚ç‚¹æ•°æ®åº“
        initNodeDatabase();
        
        // ç­‰å¾…DOMå®Œå…¨æ¸²æŸ“åç»‘å®šå¢å¼ºäº‹ä»¶ç›‘å¬
        setTimeout(() => {
            bindEnhancedEvents();
        }, 500);

        // å¢å¼ºäº‹ä»¶ç›‘å¬ç³»ç»Ÿ
        function bindEnhancedEvents() {
            // ä¸ºæ‰€æœ‰è„‘å›¾å®¹å™¨ç»‘å®šäº‹ä»¶ç›‘å¬
            ['workspace', 'knowledge', 'project'].forEach(function(tabName) {
                try {
                    const container = document.getElementById('jsmind_container_' + tabName);
                    if (container) {
                        console.log('ğŸ–±ï¸ ç»‘å®š' + tabName + 'è„‘å›¾äº‹ä»¶ç›‘å¬å™¨...');
                        
                        // å·¦é”®ç‚¹å‡»äº‹ä»¶
                        container.addEventListener('click', function(e) {
                            // éšè—å³é”®èœå•
                            hideContextMenu();
                            
                            // æŸ¥æ‰¾èŠ‚ç‚¹å…ƒç´ 
                            let nodeEl = e.target.closest('.jmnode') || e.target.closest('[nodeid]');
                            
                            if (nodeEl) {
                                const nodeId = nodeEl.getAttribute('nodeid');
                                if (nodeId) {
                                    console.log('ğŸ¯ DOMæ•è·' + tabName + 'èŠ‚ç‚¹ç‚¹å‡»:', nodeId);
                                    
                                    // åˆ‡æ¢åˆ°å¯¹åº”çš„è„‘å›¾
                                    if (currentMindmap !== tabName) {
                                        switchMindmapTab(tabName);
                                    }
                                    
                                    // ç¡®ä¿èŠ‚ç‚¹è¢«é€‰ä¸­
                                    mindmaps[tabName].select_node(nodeId);
                                    
                                    // æ˜¾ç¤ºè¯¦æƒ…
                                    showNodeDetails(nodeId);
                                    updateSelectedNodeDisplay();
                                }
                            }
                        });
                        
                        // å³é”®èœå•äº‹ä»¶ï¼ˆåªå¯¹é¡¹ç›®ç®¡ç†é€‰é¡¹å¡å¯ç”¨ï¼‰
                        if (tabName === 'project') {
                            container.addEventListener('contextmenu', function(e) {
                                e.preventDefault();
                                
                                // æŸ¥æ‰¾èŠ‚ç‚¹å…ƒç´ 
                                let nodeEl = e.target.closest('.jmnode') || e.target.closest('[nodeid]');
                                
                                if (nodeEl) {
                                    const nodeId = nodeEl.getAttribute('nodeid');
                                    if (nodeId) {
                                        // è®¾ç½®å³é”®ç›®æ ‡èŠ‚ç‚¹
                                        contextMenuTargetNode = mindmaps[tabName].get_node(nodeId);
                                        
                                        // æ˜¾ç¤ºå³é”®èœå•
                                        showContextMenu(e.clientX, e.clientY);
                                        
                                        console.log('ğŸ–±ï¸ å³é”®ç‚¹å‡»èŠ‚ç‚¹:', contextMenuTargetNode.topic);
                                    }
                                }
                            });
                        }
                        
                        console.log('âœ… ' + tabName + 'äº‹ä»¶ç›‘å¬å™¨å·²ç»‘å®š');
                    } else {
                        console.log('âŒ æœªæ‰¾åˆ°' + tabName + 'å®¹å™¨');
                    }
                } catch (error) {
                    console.log('âŒ ' + tabName + 'äº‹ä»¶ç»‘å®šå¤±è´¥:', error.message);
                }
            });
            
            // ç‚¹å‡»å…¶ä»–åŒºåŸŸéšè—å³é”®èœå•
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#contextMenu')) {
                    hideContextMenu();
                }
            });
        }

        // ä¸»é¢˜åˆ—è¡¨
        var themes = [
            { name: 'primary', label: 'è“è‰²ä¸»é¢˜' },
            { name: 'success', label: 'æˆåŠŸç»¿' },
            { name: 'warning', label: 'è­¦å‘Šæ©™' },
            { name: 'danger', label: 'å±é™©çº¢' },
            { name: 'info', label: 'ä¿¡æ¯é’' },
            { name: 'greensea', label: 'æµ·ç»¿è‰²' },
            { name: 'nephritis', label: 'ç¿¡ç¿ ç»¿' },
            { name: 'belizehole', label: 'æ·±è“è‰²' },
            { name: 'wisteria', label: 'ç´«è—¤è‰²' },
            { name: 'asphalt', label: 'æ²¥é’ç°' },
            { name: 'orange', label: 'æ©™çº¢è‰²' },
            { name: 'pumpkin', label: 'å—ç“œè‰²' },
            { name: 'pomegranate', label: 'çŸ³æ¦´çº¢' },
            { name: 'clouds', label: 'äº‘æœµç™½' },
            { name: 'asbestos', label: 'çŸ³æ£‰ç°' }
        ];

        var currentThemeIndex = 0;
        var isDragEnabled = true;

        // æ·»åŠ èŠ‚ç‚¹
        function addNode() {
            var currentJm = getCurrentJsMind();
            var selected = currentJm.get_selected_node();
            if (!selected) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                return;
            }
            
            var topic = prompt('è¯·è¾“å…¥æ–°èŠ‚ç‚¹çš„å†…å®¹:', 'æ–°èŠ‚ç‚¹');
            if (topic && topic.trim()) {
                var nodeId = 'node_' + Date.now();
                currentJm.add_node(selected, nodeId, topic.trim());
                showMessage('å·²æ·»åŠ èŠ‚ç‚¹: ' + topic);
                updateSelectedNodeDisplay();
            }
        }

        // ç¼–è¾‘èŠ‚ç‚¹
        function editNode() {
            var currentJm = getCurrentJsMind();
            var selected = currentJm.get_selected_node();
            if (!selected) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                return;
            }
            
            var newTopic = prompt('è¯·è¾“å…¥æ–°çš„èŠ‚ç‚¹å†…å®¹:', selected.topic);
            if (newTopic && newTopic.trim()) {
                currentJm.update_node(selected.id, newTopic.trim());
                showMessage('å·²æ›´æ–°èŠ‚ç‚¹: ' + newTopic);
                updateSelectedNodeDisplay();
            }
        }

        // åˆ é™¤èŠ‚ç‚¹
        function removeNode() {
            var currentJm = getCurrentJsMind();
            var selected = currentJm.get_selected_node();
            if (!selected) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                return;
            }
            
            if (selected.id === currentJm.get_root().id) {
                alert('æ ¹èŠ‚ç‚¹ä¸èƒ½åˆ é™¤');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤èŠ‚ç‚¹ "' + selected.topic + '" åŠå…¶æ‰€æœ‰å­èŠ‚ç‚¹å—ï¼Ÿ')) {
                var topic = selected.topic;
                currentJm.remove_node(selected);
                showMessage('å·²åˆ é™¤èŠ‚ç‚¹: ' + topic);
                updateSelectedNodeDisplay();
            }
        }

        // å±•å¼€å…¨éƒ¨
        function expandAll() {
            var currentJm = getCurrentJsMind();
            currentJm.expand_all();
            showMessage('å·²å±•å¼€æ‰€æœ‰èŠ‚ç‚¹');
        }

        // æ”¶èµ·å…¨éƒ¨
        function collapseAll() {
            var currentJm = getCurrentJsMind();
            var root = currentJm.get_root();
            if (root.children) {
                root.children.forEach(function(child) {
                    currentJm.collapse_node(child);
                });
            }
            showMessage('å·²æ”¶èµ·æ‰€æœ‰å­èŠ‚ç‚¹');
        }

        // åˆ‡æ¢ä¸»é¢˜
        function changeTheme() {
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            var theme = themes[currentThemeIndex];
            
            // ä¸ºæ‰€æœ‰è„‘å›¾å®ä¾‹è®¾ç½®ä¸»é¢˜
            Object.values(mindmaps).forEach(function(mindmap) {
                mindmap.set_theme(theme.name);
            });
            
            document.getElementById('currentTheme').textContent = theme.label;
            showMessage('å·²åˆ‡æ¢åˆ°ä¸»é¢˜: ' + theme.label);
            // è‡ªåŠ¨ä¿å­˜ä¸»é¢˜è®¾ç½®
            setTimeout(autoSaveData, 100);
        }

        // åˆ‡æ¢æ‹–æ‹½åŠŸèƒ½
        function toggleDrag() {
            if (isDragEnabled) {
                // ç¦ç”¨æ‰€æœ‰è„‘å›¾çš„æ‹–æ‹½åŠŸèƒ½
                Object.values(mindmaps).forEach(function(mindmap) {
                    mindmap.disable_draggable_node();
                });
                isDragEnabled = false;
                document.getElementById('dragStatus').textContent = 'å¯ç”¨æ‹–æ‹½';
                document.getElementById('dragEnabled').textContent = 'å·²ç¦ç”¨';
                showMessage('å·²ç¦ç”¨æ‹–æ‹½åŠŸèƒ½');
            } else {
                // å¯ç”¨æ‰€æœ‰è„‘å›¾çš„æ‹–æ‹½åŠŸèƒ½
                Object.values(mindmaps).forEach(function(mindmap) {
                    mindmap.enable_draggable_node();
                });
                isDragEnabled = true;
                document.getElementById('dragStatus').textContent = 'ç¦ç”¨æ‹–æ‹½';
                document.getElementById('dragEnabled').textContent = 'å·²å¯ç”¨';
                showMessage('å·²å¯ç”¨æ‹–æ‹½åŠŸèƒ½');
            }
            // è‡ªåŠ¨ä¿å­˜æ‹–æ‹½çŠ¶æ€
            setTimeout(autoSaveData, 100);
        }
        
        // æ›´æ–°æ‹–æ‹½çŠ¶æ€æ˜¾ç¤º
        function updateDragStatusDisplay() {
            if (isDragEnabled) {
                document.getElementById('dragStatus').textContent = 'ç¦ç”¨æ‹–æ‹½';
                document.getElementById('dragEnabled').textContent = 'å·²å¯ç”¨';
            } else {
                document.getElementById('dragStatus').textContent = 'å¯ç”¨æ‹–æ‹½';
                document.getElementById('dragEnabled').textContent = 'å·²ç¦ç”¨';
            }
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            var data = jm.get_data('node_tree');
            var jsonStr = JSON.stringify(data, null, 2);
            
            var newWindow = window.open('', '_blank', 'width=900,height=700');
            var htmlContent = '<!DOCTYPE html><html><head><title>æœ¬åœ°ç‰ˆæ€ç»´å¯¼å›¾æ•°æ®å¯¼å‡º</title>';
            htmlContent += '<style>body{font-family:Monaco,Consolas,monospace;margin:30px;background:#f8f9fa;}';
            htmlContent += '.container{background:white;padding:25px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}';
            htmlContent += 'h2{color:#2c3e50;margin:0 0 20px 0;}';
            htmlContent += 'pre{background:#f8f9fa;padding:20px;border-radius:6px;overflow:auto;border:1px solid #dee2e6;}</style>';
            htmlContent += '</head><body><div class="container">';
            htmlContent += '<h2>ğŸ§  jsMind æœ¬åœ°ç‰ˆæ•°æ®å¯¼å‡º</h2>';
            htmlContent += '<pre>' + jsonStr + '</pre>';
            htmlContent += '</div></body></html>';
            
            newWindow.document.write(htmlContent);
            newWindow.document.close();
        }

        // æ›´æ–°é€‰ä¸­èŠ‚ç‚¹æ˜¾ç¤º
        function updateSelectedNodeDisplay() {
            var selected = jm.get_selected_node();
            var display = selected ? selected.topic : 'æ— ';
            if (display.length > 15) {
                display = display.substring(0, 15) + '...';
            }
            document.getElementById('selectedNode').textContent = display;
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message) {
            console.log('jsMind: ' + message);
            
            // åˆ›å»ºä¸´æ—¶æ¶ˆæ¯æç¤º
            var toast = document.createElement('div');
            toast.style.cssText = 'position:fixed;top:20px;right:20px;background:#28a745;color:white;padding:12px 20px;border-radius:6px;z-index:9999;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.15);opacity:0;transition:opacity 0.3s ease;';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(function() {
                toast.style.opacity = '1';
            }, 10);
            
            // éšè—åŠ¨ç”»
            setTimeout(function() {
                toast.style.opacity = '0';
                setTimeout(function() {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 2500);
        }
        
        // æ˜¾ç¤ºèŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯ - é€‰é¡¹å¡ç‰ˆæœ¬
        function showNodeDetails(nodeId) {
            var node = getCurrentJsMind().get_node(nodeId);
            if (!node) return;
            
            // æ›´æ–°å½“å‰ç¼–è¾‘çš„èŠ‚ç‚¹ID
            currentEditingNodeId = nodeId;
            
            // ç¡®ä¿èŠ‚ç‚¹åœ¨æ•°æ®åº“ä¸­å­˜åœ¨
            if (!nodeDatabase[nodeId]) {
                nodeDatabase[nodeId] = {
                    id: nodeId,
                    title: node.topic,
                    content: '',
                    relations: {
                        parent: node.parent ? node.parent.id : null,
                        children: node.children ? node.children.map(child => child.id) : []
                    },
                    tags: {
                        categories: [],
                        technical: [],
                        status: []
                    },
                    time: {
                        created: new Date().toLocaleString(),
                        modified: new Date().toLocaleString()
                    },
                    author: ''
                };
            }
            
            // åˆ·æ–°å½“å‰æ¿€æ´»çš„é€‰é¡¹å¡å†…å®¹
            var activeTab = document.querySelector('.tab-content.active');
            if (activeTab) {
                var tabName = activeTab.id.replace('tab-', '');
                refreshTabContent(tabName, nodeId);
            }
        }
        
        // åˆ·æ–°é€‰é¡¹å¡å†…å®¹
        function refreshTabContent(tabName, nodeId) {
            var node = getCurrentJsMind().get_node(nodeId);
            if (!node || !nodeDatabase[nodeId]) return;
            
            switch(tabName) {
                case 'basic':
                    renderBasicInfo(nodeId);
                    break;
                case 'detail':
                    renderDetailInfo(nodeId);
                    break;
                case 'history':
                    renderHistoryInfo(nodeId);
                    break;
            }
        }
        
        // æ¸²æŸ“åŸºæœ¬ä¿¡æ¯é€‰é¡¹å¡
        function renderBasicInfo(nodeId) {
            var node = getCurrentJsMind().get_node(nodeId);
            var nodeData = nodeDatabase[nodeId];
            var path = getNodePath(node);
            
            var content = `
                <div class="path-breadcrumb">
                    ${path.map((item, index) => 
                        index < path.length - 1 ? 
                        `<span class="path-node">${item.replace(/<[^>]*>/g, '')}</span><span class="path-separator">â†’</span>` : 
                        `<span class="path-node">${item.replace(/<[^>]*>/g, '')}</span>`
                    ).join('')}
                </div>
                
                <div class="info-row">
                    <div class="info-label">èŠ‚ç‚¹ID:</div>
                    <div class="info-value">${nodeData.id}</div>
                </div>
                
                <div class="info-row">
                    <div class="info-label">æ ‡é¢˜:</div>
                    <div class="info-value">${nodeData.title}</div>
                </div>
                
                <div class="info-row">
                    <div class="info-label">çˆ¶èŠ‚ç‚¹:</div>
                    <div class="info-value">${nodeData.relations.parent ? 
                        getCurrentJsMind().get_node(nodeData.relations.parent) ? getCurrentJsMind().get_node(nodeData.relations.parent).topic : nodeData.relations.parent
                        : 'æ— ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰'}</div>
                </div>
                
                <div class="info-row">
                    <div class="info-label">å­èŠ‚ç‚¹:</div>
                    <div class="info-value">${nodeData.relations.children.length} ä¸ª</div>
                </div>
                
                <div class="info-row">
                    <div class="info-label">åˆ›å»ºæ—¶é—´:</div>
                    <div class="info-value">${nodeData.time.created}</div>
                </div>
                
                <div class="info-row">
                    <div class="info-label">ä¿®æ”¹æ—¶é—´:</div>
                    <div class="info-value">${nodeData.time.modified}</div>
                </div>
                
                <div class="info-row">
                    <div class="info-label">ä½œè€…:</div>
                    <div class="info-value">${nodeData.author || 'æœªè®¾ç½®'}</div>
                </div>
                
                ${renderAllTags(nodeId)}
            `;
            
            document.getElementById('basic-info-content').innerHTML = content;
        }
        
        // æ¸²æŸ“è¯¦ç»†ä¿¡æ¯é€‰é¡¹å¡
        function renderDetailInfo(nodeId) {
            var nodeData = nodeDatabase[nodeId];
            
            var content = `
                <form onsubmit="event.preventDefault(); saveNodeDetails('${nodeId}');" class="node-detail-form">
                    <div class="detail-header">
                        <input type="text" id="node_author_${nodeId}" value="${nodeData.author}" class="author-input-small" placeholder="ä½œè€…">
                    </div>
                    
                    <div class="form-group">
                        <label for="node_title_${nodeId}" class="form-label">èŠ‚ç‚¹æ ‡é¢˜:</label>
                        <input type="text" id="node_title_${nodeId}" value="${nodeData.title}" class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label for="node_content_${nodeId}" class="form-label">è¯¦ç»†å†…å®¹:</label>
                        <textarea id="node_content_${nodeId}" class="form-textarea" placeholder="è¾“å…¥èŠ‚ç‚¹çš„è¯¦ç»†æè¿°ã€è¯´æ˜æˆ–å¤‡æ³¨...">${nodeData.content}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ğŸ·ï¸ åˆ†ç±»æ ‡ç­¾:</label>
                        <div class="tag-input-group">
                            <input type="text" id="categories_input_${nodeId}" class="tag-input" placeholder="è¾“å…¥åˆ†ç±»æ ‡ç­¾ï¼Œå¦‚ï¼šå·¥ä½œã€å­¦ä¹ ã€é¡¹ç›®">
                            <button type="button" onclick="addTagFromInput('${nodeId}', 'categories')" class="tag-add-btn">æ·»åŠ </button>
                        </div>
                        <div id="categories_${nodeId}" class="tag-list">
                            ${nodeData.tags.categories.map(tag => `<span class="tag-item">${tag} <button type="button" onclick="removeTag('${nodeId}', 'categories', '${tag}')" class="tag-remove">Ã—</button></span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ğŸ’» æŠ€æœ¯æ ‡ç­¾:</label>
                        <div class="tag-input-group">
                            <input type="text" id="technical_input_${nodeId}" class="tag-input" placeholder="è¾“å…¥æŠ€æœ¯æ ‡ç­¾ï¼Œå¦‚ï¼šJavaScriptã€Pythonã€æ•°æ®åº“">
                            <button type="button" onclick="addTagFromInput('${nodeId}', 'technical')" class="tag-add-btn">æ·»åŠ </button>
                        </div>
                        <div id="technical_${nodeId}" class="tag-list">
                            ${nodeData.tags.technical.map(tag => `<span class="tag-item">${tag} <button type="button" onclick="removeTag('${nodeId}', 'technical', '${tag}')" class="tag-remove">Ã—</button></span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ğŸ“Š çŠ¶æ€æ ‡ç­¾:</label>
                        <div class="tag-input-group">
                            <input type="text" id="status_input_${nodeId}" class="tag-input" placeholder="è¾“å…¥çŠ¶æ€æ ‡ç­¾ï¼Œå¦‚ï¼šè¿›è¡Œä¸­ã€å·²å®Œæˆã€å¾…å¼€å§‹">
                            <button type="button" onclick="addTagFromInput('${nodeId}', 'status')" class="tag-add-btn">æ·»åŠ </button>
                        </div>
                        <div id="status_${nodeId}" class="tag-list">
                            ${nodeData.tags.status.map(tag => `<span class="tag-item">${tag} <button type="button" onclick="removeTag('${nodeId}', 'status', '${tag}')" class="tag-remove">Ã—</button></span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">ğŸ’¾ ä¿å­˜æ›´æ”¹</button>
                        <button type="button" onclick="resetNodeDetails('${nodeId}')" class="btn-secondary">ğŸ”„ é‡ç½®</button>
                    </div>
                </form>
            `;
            
            document.getElementById('detail-info-content').innerHTML = content;
        }
        
        // æ¸²æŸ“å†å²è®°å½•é€‰é¡¹å¡
        function renderHistoryInfo(nodeId) {
            var nodeData = nodeDatabase[nodeId];
            
            // ç”Ÿæˆå†å²è®°å½•ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…é¡¹ç›®ä¸­åº”è¯¥ä»çœŸå®å†å²æ•°æ®è·å–ï¼‰
            var historyItems = [
                {
                    time: nodeData.time.created,
                    action: 'èŠ‚ç‚¹åˆ›å»º',
                    detail: `åˆ›å»ºäº†èŠ‚ç‚¹ï¼š"${nodeData.title}"`
                },
                {
                    time: nodeData.time.modified,
                    action: 'æœ€åä¿®æ”¹',
                    detail: 'æ›´æ–°äº†èŠ‚ç‚¹ä¿¡æ¯'
                }
            ];
            
            // å¦‚æœæœ‰æ ‡ç­¾ï¼Œæ·»åŠ æ ‡ç­¾ç›¸å…³å†å²
            var allTags = [...nodeData.tags.categories, ...nodeData.tags.technical, ...nodeData.tags.status];
            if (allTags.length > 0) {
                historyItems.push({
                    time: nodeData.time.modified,
                    action: 'æ ‡ç­¾ç®¡ç†',
                    detail: `è®¾ç½®äº† ${allTags.length} ä¸ªæ ‡ç­¾ï¼š${allTags.slice(0, 3).join('ã€')}${allTags.length > 3 ? '...' : ''}`
                });
            }
            
            // å¦‚æœæœ‰å†…å®¹ï¼Œæ·»åŠ å†…å®¹ç¼–è¾‘å†å²
            if (nodeData.content.trim()) {
                historyItems.push({
                    time: nodeData.time.modified,
                    action: 'å†…å®¹ç¼–è¾‘',
                    detail: `æ·»åŠ äº†è¯¦ç»†æè¿°ï¼ˆ${nodeData.content.length} å­—ç¬¦ï¼‰`
                });
            }
            
            // æŒ‰æ—¶é—´æ’åº
            historyItems.sort((a, b) => new Date(b.time) - new Date(a.time));
            
            var content = `
                <h4>ğŸ“š èŠ‚ç‚¹å†å²è®°å½•</h4>
                ${historyItems.length > 0 ? 
                    historyItems.map(item => `
                        <div class="history-item">
                            <div class="history-time">${item.time}</div>
                            <div class="history-action">${item.action}</div>
                            <div class="history-detail">${item.detail}</div>
                        </div>
                    `).join('') :
                    `<div class="empty-state">
                        <div class="icon">ğŸ“š</div>
                        <div>æš‚æ— å†å²è®°å½•</div>
                    </div>`
                }
            `;
            
            document.getElementById('history-info-content').innerHTML = content;
        }
        
        // æ¸²æŸ“æ‰€æœ‰æ ‡ç­¾ï¼ˆç”¨äºåŸºæœ¬ä¿¡æ¯é€‰é¡¹å¡ï¼‰
        function renderAllTags(nodeId) {
            var nodeData = nodeDatabase[nodeId];
            var hasAnyTags = nodeData.tags.categories.length > 0 || 
                           nodeData.tags.technical.length > 0 || 
                           nodeData.tags.status.length > 0;
            
            if (!hasAnyTags) {
                return `
                    <div class="info-row">
                        <div class="info-label">æ ‡ç­¾:</div>
                        <div class="info-value">æ— æ ‡ç­¾</div>
                    </div>
                `;
            }
            
            var tagsHTML = '';
            
            if (nodeData.tags.categories.length > 0) {
                tagsHTML += `
                    <div class="info-row">
                        <div class="info-label">åˆ†ç±»æ ‡ç­¾:</div>
                        <div class="info-value">
                            <div class="tag-list">
                                ${nodeData.tags.categories.map(tag => `<span class="tag-item">${tag}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (nodeData.tags.technical.length > 0) {
                tagsHTML += `
                    <div class="info-row">
                        <div class="info-label">æŠ€æœ¯æ ‡ç­¾:</div>
                        <div class="info-value">
                            <div class="tag-list">
                                ${nodeData.tags.technical.map(tag => `<span class="tag-item">${tag}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (nodeData.tags.status.length > 0) {
                tagsHTML += `
                    <div class="info-row">
                        <div class="info-label">çŠ¶æ€æ ‡ç­¾:</div>
                        <div class="info-value">
                            <div class="tag-list">
                                ${nodeData.tags.status.map(tag => `<span class="tag-item">${tag}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            return tagsHTML;
        }
        
        // éšè—èŠ‚ç‚¹ä¿¡æ¯é¢æ¿
        function hideNodeInfoPanel() {
            var panel = document.getElementById('node-info-panel');
            panel.style.display = 'none';
        }

        // è„‘å›¾é€‰é¡¹å¡åˆ‡æ¢å‡½æ•°
        function switchMindmapTab(tabName) {
            // å…ˆè‡ªåŠ¨ä¿å­˜å½“å‰ç¼–è¾‘å†…å®¹
            autoSaveCurrentNodeDetails();
            
            // æ›´æ–°å½“å‰æ´»è·ƒçš„è„‘å›¾
            currentMindmap = tabName;
            
            // æ¸…é™¤æ‰€æœ‰è„‘å›¾é€‰é¡¹å¡çš„activeçŠ¶æ€
            var tabButtons = document.querySelectorAll('.mindmap-tab-button');
            var tabContents = document.querySelectorAll('.mindmap-tab-content');
            
            tabButtons.forEach(function(btn) {
                btn.classList.remove('active');
            });
            
            tabContents.forEach(function(content) {
                content.classList.remove('active');
            });
            
            // æ¿€æ´»é€‰ä¸­çš„è„‘å›¾é€‰é¡¹å¡
            document.querySelector('.mindmap-tab-button[onclick="switchMindmapTab(\'' + tabName + '\')"]').classList.add('active');
            document.getElementById('mindmap-tab-' + tabName).classList.add('active');
            
            // æ›´æ–°å…¨å±€jmå˜é‡æŒ‡å‘å½“å‰æ´»è·ƒçš„è„‘å›¾
            jm = getCurrentJsMind();
            
            // å¦‚æœæ–°è„‘å›¾æœ‰é€‰ä¸­çš„èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå…¶è¯¦æƒ…
            var selectedNode = jm.get_selected_node();
            if (selectedNode) {
                showNodeDetails(selectedNode.id);
                updateSelectedNodeDisplay();
            } else {
                // æ¸…é™¤è¯¦æƒ…æ˜¾ç¤º
                clearNodeDetails();
            }
            
            console.log('ğŸ”„ åˆ‡æ¢åˆ°è„‘å›¾:', tabName);
        }
        
        // æ˜¾ç¤ºå³é”®èœå•
        function showContextMenu(x, y) {
            var menu = document.getElementById('contextMenu');
            menu.style.left = x + 'px';
            menu.style.top = y + 'px';
            menu.style.display = 'block';
            
            // ç¡®ä¿èœå•ä¸è¶…å‡ºå±å¹•è¾¹ç•Œ
            var rect = menu.getBoundingClientRect();
            if (rect.right > window.innerWidth) {
                menu.style.left = (x - rect.width) + 'px';
            }
            if (rect.bottom > window.innerHeight) {
                menu.style.top = (y - rect.height) + 'px';
            }
        }
        
        // éšè—å³é”®èœå•
        function hideContextMenu() {
            var menu = document.getElementById('contextMenu');
            menu.style.display = 'none';
            contextMenuTargetNode = null;
        }
        
        // å°†ç„¦ç‚¹èŠ‚ç‚¹å¤åˆ¶åˆ°ä¸´æ—¶å·¥ä½œåŒº
        function focusNodeToWorkspaces() {
            if (!contextMenuTargetNode) {
                hideContextMenu();
                return;
            }
            
            try {
                // å¤åˆ¶èŠ‚ç‚¹åŠå…¶å­æ ‘
                var nodeTree = copyNodeTree(contextMenuTargetNode);
                
                // å¤åˆ¶åˆ°ä¸´æ—¶å·¥ä½œåŒºA
                var workspaceData = {
                    meta: {
                        name: "ä¸´æ—¶å·¥ä½œåŒºA - " + contextMenuTargetNode.topic,
                        author: "NodeMind",
                        version: "1.0.0"
                    },
                    format: "node_tree",
                    data: nodeTree
                };
                mindmaps.workspace.show(workspaceData);
                
                // å¤åˆ¶åˆ°ä¸´æ—¶å·¥ä½œåŒºB
                var knowledgeData = {
                    meta: {
                        name: "ä¸´æ—¶å·¥ä½œåŒºB - " + contextMenuTargetNode.topic,
                        author: "NodeMind",
                        version: "1.0.0"
                    },
                    format: "node_tree",
                    data: nodeTree
                };
                mindmaps.knowledge.show(knowledgeData);
                
                showMessage('ğŸ”¬ å·²å°†ç„¦ç‚¹èŠ‚ç‚¹"' + contextMenuTargetNode.topic + '"å¤åˆ¶åˆ°ä¸´æ—¶å·¥ä½œåŒº');
                console.log('âœ… ç„¦ç‚¹èŠ‚ç‚¹å·²å¤åˆ¶åˆ°ä¸´æ—¶å·¥ä½œåŒº:', contextMenuTargetNode.topic);
                
                hideContextMenu();
                
            } catch (error) {
                console.error('âŒ å¤åˆ¶èŠ‚ç‚¹åˆ°ä¸´æ—¶å·¥ä½œåŒºå¤±è´¥:', error);
                showMessage('âŒ å¤åˆ¶å¤±è´¥: ' + error.message);
                hideContextMenu();
            }
        }
        
        // é€’å½’å¤åˆ¶èŠ‚ç‚¹æ ‘ï¼ˆä¿æŒåŸå§‹IDå’Œæ‰€æœ‰è¯¦ç»†ä¿¡æ¯ï¼‰
        function copyNodeTree(node) {
            var newNode = {
                id: node.id,  // ä¿æŒåŸå§‹èŠ‚ç‚¹IDï¼Œç¡®ä¿è¯¦ç»†ä¿¡æ¯èƒ½æ­£ç¡®å…³è”
                topic: node.topic
            };
            
            // ç¡®ä¿èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯åœ¨nodeDatabaseä¸­å­˜åœ¨
            if (!nodeDatabase[node.id]) {
                // å¦‚æœnodeDatabaseä¸­æ²¡æœ‰è¿™ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œåˆ›å»ºé»˜è®¤ä¿¡æ¯
                nodeDatabase[node.id] = {
                    id: node.id,
                    title: node.topic,
                    content: '',
                    author: '',
                    time: {
                        created: new Date().toLocaleString(),
                        modified: new Date().toLocaleString()
                    },
                    tags: {
                        categories: [],
                        technical: [],
                        status: []
                    }
                };
            }
            
            // å¦‚æœæœ‰å­èŠ‚ç‚¹ï¼Œé€’å½’å¤åˆ¶
            if (node.children && node.children.length > 0) {
                newNode.children = [];
                node.children.forEach(function(child, index) {
                    var childNode = copyNodeTree(child);
                    // è®¾ç½®æ–¹å‘ï¼šå·¦å³äº¤æ›¿åˆ†å¸ƒ
                    childNode.direction = index % 2 === 0 ? 'right' : 'left';
                    newNode.children.push(childNode);
                });
            }
            
            return newNode;
        }
        
        // æ¸…é™¤èŠ‚ç‚¹è¯¦æƒ…æ˜¾ç¤º
        function clearNodeDetails() {
            var emptyStates = [
                { id: 'basic-info-content', icon: 'ğŸ“‹', text: 'ç‚¹å‡»æ€ç»´å¯¼å›¾ä¸­çš„èŠ‚ç‚¹æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯' },
                { id: 'detail-info-content', icon: 'ğŸ“', text: 'ç‚¹å‡»æ€ç»´å¯¼å›¾ä¸­çš„èŠ‚ç‚¹ç¼–è¾‘è¯¦ç»†æè¿°' },
                { id: 'history-info-content', icon: 'ğŸ“š', text: 'ç‚¹å‡»æ€ç»´å¯¼å›¾ä¸­çš„èŠ‚ç‚¹æŸ¥çœ‹å†å²è®°å½•' }
            ];
            
            emptyStates.forEach(state => {
                var element = document.getElementById(state.id);
                if (element) {
                    element.innerHTML = `
                        <div class="empty-state">
                            <div class="icon">${state.icon}</div>
                            <div>${state.text}</div>
                        </div>
                    `;
                }
            });
            
            // æ¸…é™¤å½“å‰ç¼–è¾‘èŠ‚ç‚¹ID
            currentEditingNodeId = null;
            
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            document.getElementById('selectedNode').textContent = 'æ— ';
        }
        
        // è¯¦æƒ…é¡µé€‰é¡¹å¡åˆ‡æ¢åŠŸèƒ½
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰é€‰é¡¹å¡å†…å®¹
            var tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(function(tab) {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰é€‰é¡¹å¡æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            var tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(function(button) {
                button.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„é€‰é¡¹å¡å†…å®¹
            var selectedTab = document.getElementById('tab-' + tabName);
            var selectedButton = event.target;
            
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            if (selectedButton) {
                selectedButton.classList.add('active');
            }
            
            // å¦‚æœæœ‰é€‰ä¸­çš„èŠ‚ç‚¹ï¼Œåˆ·æ–°å¯¹åº”é€‰é¡¹å¡çš„å†…å®¹
            var selected = jm.get_selected_node();
            if (selected) {
                refreshTabContent(tabName, selected.id);
            }
        }
        
        // ä¿å­˜èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯å¹¶åŒæ­¥åˆ°æ‰€æœ‰å·¥ä½œåŒº
        function saveNodeDetails(nodeId) {
            var node = getCurrentJsMind().get_node(nodeId);
            if (!node || !nodeDatabase[nodeId]) return;
            
            // è·å–è¡¨å•æ•°æ®
            var title = document.getElementById('node_title_' + nodeId).value;
            var content = document.getElementById('node_content_' + nodeId).value;
            var author = document.getElementById('node_author_' + nodeId).value;
            
            // æ›´æ–°èŠ‚ç‚¹æ•°æ®åº“
            nodeDatabase[nodeId].title = title;
            nodeDatabase[nodeId].content = content;
            nodeDatabase[nodeId].author = author;
            nodeDatabase[nodeId].time.modified = new Date().toLocaleString();
            
            // åŒæ­¥æ›´æ–°æ‰€æœ‰å·¥ä½œåŒºä¸­çš„ç›¸åŒèŠ‚ç‚¹æ ‡é¢˜
            Object.keys(mindmaps).forEach(function(tabName) {
                var mindmap = mindmaps[tabName];
                var targetNode = mindmap.get_node(nodeId);
                if (targetNode && targetNode.topic !== title) {
                    mindmap.update_node(nodeId, title);
                }
            });
            
            showMessage('ğŸ’¾ èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯å·²ä¿å­˜');
            
            // åˆ·æ–°å…¶ä»–é€‰é¡¹å¡å†…å®¹ï¼ˆå¦‚åŸºæœ¬ä¿¡æ¯é€‰é¡¹å¡ä¸­çš„ä½œè€…æ˜¾ç¤ºï¼‰
            var currentTab = document.querySelector('.tab-content.active');
            if (currentTab && currentTab.id === 'tab-detail') {
                // å¦‚æœåœ¨è¯¦ç»†æè¿°é€‰é¡¹å¡ï¼Œå¯ä»¥é€‰æ‹©æ€§åˆ·æ–°åŸºæœ¬ä¿¡æ¯é€‰é¡¹å¡çš„å†…å®¹
                setTimeout(() => {
                    renderBasicInfo(nodeId);
                }, 100);
            }
            
            // è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            setTimeout(autoSaveData, 200);
        }
        
        // é‡ç½®èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯
        function resetNodeDetails(nodeId) {
            var activeTab = document.querySelector('.tab-content.active');
            if (activeTab) {
                var tabName = activeTab.id.replace('tab-', '');
                refreshTabContent(tabName, nodeId);
            }
            showMessage('èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯å·²é‡ç½®');
        }
        
        // æ›´æ–°èŠ‚ç‚¹æ ‡é¢˜
        function updateNodeTitle(nodeId, newTitle) {
            var node = jm.get_node(nodeId);
            if (node && newTitle && newTitle.trim()) {
                jm.update_node(nodeId, newTitle.trim());
                nodeDatabase[nodeId].title = newTitle.trim();
                nodeDatabase[nodeId].time.modified = new Date().toLocaleString();
            }
        }
        
        // ä»è¾“å…¥æ¡†æ·»åŠ æ ‡ç­¾
        function addTagFromInput(nodeId, tagType) {
            var input = document.getElementById(tagType + '_input_' + nodeId);
            if (!input) return;
            
            var tagValue = input.value.trim();
            if (!tagValue) return;
            
            addTag(nodeId, tagType, tagValue);
            input.value = '';
            
            // åˆ·æ–°å½“å‰é€‰é¡¹å¡å†…å®¹
            var activeTab = document.querySelector('.tab-content.active');
            if (activeTab) {
                var tabName = activeTab.id.replace('tab-', '');
                refreshTabContent(tabName, nodeId);
            }
        }
        
        // æ·»åŠ æ ‡ç­¾
        function addTag(nodeId, tagType, tagValue) {
            if (!tagValue || !tagValue.trim()) return;
            
            tagValue = tagValue.trim();
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒæ ‡ç­¾
            if (nodeDatabase[nodeId].tags[tagType].includes(tagValue)) {
                showMessage('æ ‡ç­¾å·²å­˜åœ¨ï¼š' + tagValue);
                return;
            }
            
            // æ·»åŠ æ ‡ç­¾
            nodeDatabase[nodeId].tags[tagType].push(tagValue);
            
            // æ›´æ–°ä¿®æ”¹æ—¶é—´
            nodeDatabase[nodeId].time.modified = new Date().toLocaleString();
            
            showMessage('å·²æ·»åŠ ' + getTagTypeLabel(tagType) + 'ï¼š' + tagValue);
            
            // è‡ªåŠ¨ä¿å­˜
            setTimeout(autoSaveData, 200);
        }
        
        // è·å–æ ‡ç­¾ç±»å‹ä¸­æ–‡åç§°
        function getTagTypeLabel(tagType) {
            switch(tagType) {
                case 'categories': return 'åˆ†ç±»æ ‡ç­¾';
                case 'technical': return 'æŠ€æœ¯æ ‡ç­¾';
                case 'status': return 'çŠ¶æ€æ ‡ç­¾';
                default: return 'æ ‡ç­¾';
            }
        }
        
        // ç§»é™¤æ ‡ç­¾
        function removeTag(nodeId, tagType, tagValue) {
            // ä»æ•°ç»„ä¸­ç§»é™¤æ ‡ç­¾
            var index = nodeDatabase[nodeId].tags[tagType].indexOf(tagValue);
            if (index !== -1) {
                nodeDatabase[nodeId].tags[tagType].splice(index, 1);
            }
            
            // æ›´æ–°ä¿®æ”¹æ—¶é—´
            nodeDatabase[nodeId].time.modified = new Date().toLocaleString();
            
            showMessage('å·²ç§»é™¤' + getTagTypeLabel(tagType) + 'ï¼š' + tagValue);
            
            // åˆ·æ–°å½“å‰é€‰é¡¹å¡å†…å®¹
            var activeTab = document.querySelector('.tab-content.active');
            if (activeTab) {
                var tabName = activeTab.id.replace('tab-', '');
                refreshTabContent(tabName, nodeId);
            }
            
            // è‡ªåŠ¨ä¿å­˜
            setTimeout(autoSaveData, 200);
        }
        
        // æ›´æ–°èŠ‚ç‚¹å…³ç³»
        function updateNodeRelations(nodeId) {
            var node = jm.get_node(nodeId);
            if (!node || !nodeDatabase[nodeId]) return;
            
            // æ›´æ–°çˆ¶èŠ‚ç‚¹å…³ç³»
            nodeDatabase[nodeId].relations.parent = node.parent ? node.parent.id : null;
            
            // æ›´æ–°å­èŠ‚ç‚¹å…³ç³»
            nodeDatabase[nodeId].relations.children = node.children ? node.children.map(child => child.id) : [];
            
            // å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯é€‰ä¸­èŠ‚ç‚¹ï¼Œæ›´æ–°æ˜¾ç¤º
            var selected = jm.get_selected_node();
            if (selected && selected.id === nodeId) {
                showNodeDetails(nodeId);
            }
        }
        
        // è·å–èŠ‚ç‚¹è·¯å¾„
        function getNodePath(node) {
            var path = [];
            var current = node;
            
            while (current) {
                path.unshift(`<span>${current.topic}</span>`);
                current = current.parent;
            }
            
            return path;
        }
        
        // è·å–èŠ‚ç‚¹çš„è‡ªå®šä¹‰å±æ€§
        function getCustomProperties(node) {
            var props = [];
            var standardProps = ['id', 'topic', 'direction', 'expanded', 'parent', 'children', 'data', '_data', 'isroot'];
            
            for (var key in node) {
                if (node.hasOwnProperty(key) && !standardProps.includes(key)) {
                    var value = node[key];
                    if (typeof value !== 'function' && typeof value !== 'object') {
                        props.push({
                            key: key,
                            value: value
                        });
                    }
                }
            }
            
            return props;
        }

        // è®¾ç½®è‡ªåŠ¨ä¿å­˜
        function setupAutoSave() {
            // å®šæœŸè‡ªåŠ¨ä¿å­˜ï¼ˆæ¯30ç§’ï¼‰
            setInterval(function() {
                autoSaveCurrentNodeDetails(); // ä¿å­˜å½“å‰ç¼–è¾‘å†…å®¹
                autoSaveData();
            }, 30000);
            
            // é¡µé¢ç¦»å¼€æ—¶ä¿å­˜
            window.addEventListener('beforeunload', function() {
                autoSaveCurrentNodeDetails(); // ä¿å­˜å½“å‰ç¼–è¾‘å†…å®¹
                autoSaveData();
            });
            
            // é¡µé¢å¤±å»ç„¦ç‚¹æ—¶ä¿å­˜
            window.addEventListener('blur', function() {
                autoSaveCurrentNodeDetails(); // ä¿å­˜å½“å‰ç¼–è¾‘å†…å®¹
                autoSaveData();
            });
        }

        // å½“å‰æ­£åœ¨ç¼–è¾‘çš„èŠ‚ç‚¹IDï¼ˆç”¨äºè‡ªåŠ¨ä¿å­˜ï¼‰
        var currentEditingNodeId = null;
        
        // è‡ªåŠ¨ä¿å­˜å½“å‰ç¼–è¾‘èŠ‚ç‚¹çš„è¯¦ç»†å†…å®¹å¹¶åŒæ­¥åˆ°æ‰€æœ‰å·¥ä½œåŒº
        function autoSaveCurrentNodeDetails() {
            if (!currentEditingNodeId) return;
            
            try {
                var titleEl = document.getElementById('node_title_' + currentEditingNodeId);
                var contentEl = document.getElementById('node_content_' + currentEditingNodeId);
                var authorEl = document.getElementById('node_author_' + currentEditingNodeId);
                
                if (titleEl && contentEl && authorEl && nodeDatabase[currentEditingNodeId]) {
                    var hasChanges = false;
                    
                    // æ£€æŸ¥å¹¶æ›´æ–°æ ‡é¢˜
                    if (titleEl.value !== nodeDatabase[currentEditingNodeId].title) {
                        nodeDatabase[currentEditingNodeId].title = titleEl.value;
                        hasChanges = true;
                        
                        // åŒæ­¥æ›´æ–°æ‰€æœ‰å·¥ä½œåŒºä¸­çš„ç›¸åŒèŠ‚ç‚¹æ ‡é¢˜
                        Object.keys(mindmaps).forEach(function(tabName) {
                            var mindmap = mindmaps[tabName];
                            var targetNode = mindmap.get_node(currentEditingNodeId);
                            if (targetNode && targetNode.topic !== titleEl.value) {
                                mindmap.update_node(currentEditingNodeId, titleEl.value);
                            }
                        });
                    }
                    
                    // æ£€æŸ¥å¹¶æ›´æ–°è¯¦ç»†å†…å®¹
                    if (contentEl.value !== nodeDatabase[currentEditingNodeId].content) {
                        nodeDatabase[currentEditingNodeId].content = contentEl.value;
                        hasChanges = true;
                    }
                    
                    // æ£€æŸ¥å¹¶æ›´æ–°ä½œè€…
                    if (authorEl.value !== nodeDatabase[currentEditingNodeId].author) {
                        nodeDatabase[currentEditingNodeId].author = authorEl.value;
                        hasChanges = true;
                    }
                    
                    if (hasChanges) {
                        nodeDatabase[currentEditingNodeId].time.modified = new Date().toLocaleString();
                        console.log('ğŸ”„ è‡ªåŠ¨ä¿å­˜èŠ‚ç‚¹è¯¦ç»†å†…å®¹å¹¶åŒæ­¥åˆ°æ‰€æœ‰å·¥ä½œåŒº:', currentEditingNodeId);
                        // è§¦å‘æŒä¹…åŒ–å­˜å‚¨
                        setTimeout(autoSaveData, 100);
                    }
                }
            } catch (error) {
                console.error('è‡ªåŠ¨ä¿å­˜èŠ‚ç‚¹è¯¦ç»†å†…å®¹å¤±è´¥:', error);
            }
        }

        // ä¸ºæ‰€æœ‰è„‘å›¾å®ä¾‹æ·»åŠ äº‹ä»¶ç›‘å¬
        function addEventListenersToAllMindmaps() {
            Object.keys(mindmaps).forEach(function(tabName) {
                var mindmap = mindmaps[tabName];
                
                mindmap.add_event_listener(function(type, data) {
                    // ç¡®ä¿å½“å‰è„‘å›¾æ ‡ç­¾è¢«æ¿€æ´»
                    if (currentMindmap !== tabName) {
                        switchMindmapTab(tabName);
                    }
                    
                    if (type === 'select_node') {
                        // åœ¨åˆ‡æ¢åˆ°æ–°èŠ‚ç‚¹å‰ï¼Œå…ˆè‡ªåŠ¨ä¿å­˜å½“å‰ç¼–è¾‘èŠ‚ç‚¹çš„è¯¦ç»†å†…å®¹
                        autoSaveCurrentNodeDetails();
                        
                        updateSelectedNodeDisplay();
                        showNodeDetails(data.node.id);
                        console.log('é€‰ä¸­' + tabName + 'èŠ‚ç‚¹:', data.node.topic);
                        // è‡ªåŠ¨ä¿å­˜é€‰ä¸­çŠ¶æ€
                        setTimeout(autoSaveData, 100);
                    } else if (type === 'edit_node') {
                        showNodeDetails(data.node.id);
                        console.log('ç¼–è¾‘' + tabName + 'èŠ‚ç‚¹:', data.node.topic);
                        // è‡ªåŠ¨ä¿å­˜ç¼–è¾‘
                        setTimeout(autoSaveData, 500);
                    } else if (type === 'move_node') {
                        showMessage('ğŸ”€ èŠ‚ç‚¹å·²ç§»åŠ¨: ' + data.node.topic);
                        console.log('ç§»åŠ¨' + tabName + 'èŠ‚ç‚¹:', data.node.topic, 'åˆ°æ–°ä½ç½®');
                        updateSelectedNodeDisplay();
                        updateNodeRelations(data.node.id);
                        if (data.parent_node) {
                            updateNodeRelations(data.parent_node.id);
                        }
                        // è‡ªåŠ¨ä¿å­˜ç§»åŠ¨æ“ä½œ
                        setTimeout(autoSaveData, 200);
                    } else if (type === 'add_node') {
                        updateNodeRelations(data.node.id);
                        if (data.parent_node) {
                            updateNodeRelations(data.parent_node.id);
                        }
                        showNodeDetails(data.node.id);
                        // è‡ªåŠ¨ä¿å­˜æ–°å¢èŠ‚ç‚¹
                        setTimeout(autoSaveData, 200);
                    } else if (type === 'remove_node') {
                        if (data.parent_node) {
                            updateNodeRelations(data.parent_node.id);
                        }
                        // è‡ªåŠ¨ä¿å­˜åˆ é™¤æ“ä½œ
                        setTimeout(autoSaveData, 200);
                    }
                });
            });
        }
        
        // ä¸ºæ‰€æœ‰è„‘å›¾æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        addEventListenersToAllMindmaps();

        // æŒä¹…åŒ–å­˜å‚¨ç›¸å…³å¸¸é‡
        var STORAGE_KEYS = {
            MINDMAP_DATA: 'nodemind_mindmap_data',
            NODE_DATABASE: 'nodemind_node_database', 
            CURRENT_THEME: 'nodemind_current_theme',
            DRAG_ENABLED: 'nodemind_drag_enabled',
            SELECTED_NODE: 'nodemind_selected_node',
            VIEW_DATA: 'nodemind_view_data'
        };
        
        // è‡ªåŠ¨ä¿å­˜å‡½æ•°
        function autoSaveData() {
            try {
                // ä¿å­˜æ‰€æœ‰è„‘å›¾çš„æ•°æ®
                var allMindmapData = {};
                Object.keys(mindmaps).forEach(function(tabName) {
                    if (mindmaps[tabName]) {
                        allMindmapData[tabName] = mindmaps[tabName].get_data();
                    }
                });
                
                if (Object.keys(allMindmapData).length > 0) {
                    // ä¿å­˜æ‰€æœ‰æ€ç»´å¯¼å›¾æ•°æ®
                    localStorage.setItem(STORAGE_KEYS.MINDMAP_DATA, JSON.stringify(allMindmapData));
                    
                    // ä¿å­˜èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯æ•°æ®åº“
                    localStorage.setItem(STORAGE_KEYS.NODE_DATABASE, JSON.stringify(nodeDatabase));
                    
                    // ä¿å­˜å½“å‰ä¸»é¢˜
                    localStorage.setItem(STORAGE_KEYS.CURRENT_THEME, currentThemeIndex.toString());
                    
                    // ä¿å­˜æ‹–æ‹½çŠ¶æ€
                    localStorage.setItem(STORAGE_KEYS.DRAG_ENABLED, isDragEnabled.toString());
                    
                    // ä¿å­˜å½“å‰æ´»è·ƒçš„è„‘å›¾é€‰é¡¹å¡
                    localStorage.setItem('nodemind_current_mindmap', currentMindmap);
                    
                    // ä¿å­˜é€‰ä¸­èŠ‚ç‚¹
                    var selectedNode = getCurrentJsMind().get_selected_node();
                    if (selectedNode) {
                        localStorage.setItem(STORAGE_KEYS.SELECTED_NODE, selectedNode.id);
                    }
                    
                    console.log('âœ… æ•°æ®å·²è‡ªåŠ¨ä¿å­˜ï¼ˆåŒ…å«æ‰€æœ‰è„‘å›¾ï¼‰');
                }
            } catch (error) {
                console.error('è‡ªåŠ¨ä¿å­˜å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½ä¿å­˜çš„æ•°æ®
        function loadSavedData() {
            try {
                // åŠ è½½æ€ç»´å¯¼å›¾æ•°æ®
                var savedMindmapData = localStorage.getItem(STORAGE_KEYS.MINDMAP_DATA);
                var savedNodeDatabase = localStorage.getItem(STORAGE_KEYS.NODE_DATABASE);
                var savedTheme = localStorage.getItem(STORAGE_KEYS.CURRENT_THEME);
                var savedDragState = localStorage.getItem(STORAGE_KEYS.DRAG_ENABLED);
                var savedSelectedNode = localStorage.getItem(STORAGE_KEYS.SELECTED_NODE);
                var savedCurrentMindmap = localStorage.getItem('nodemind_current_mindmap');
                
                var hasRecoveredData = false;
                
                // æ¢å¤å¤šå·¥ä½œåŒºæ€ç»´å¯¼å›¾æ•°æ®
                if (savedMindmapData) {
                    try {
                        var allMindmapData = JSON.parse(savedMindmapData);
                        
                        // æ¢å¤æ¯ä¸ªå·¥ä½œåŒºçš„æ•°æ®
                        if (allMindmapData && typeof allMindmapData === 'object') {
                            Object.keys(allMindmapData).forEach(function(tabName) {
                                var mindmapData = allMindmapData[tabName];
                                if (mindmapData && mindmapData.data && mindmaps[tabName]) {
                                    mindmaps[tabName].show(mindmapData);
                                    hasRecoveredData = true;
                                    console.log('âœ… ' + tabName + ' å·¥ä½œåŒºæ•°æ®å·²æ¢å¤');
                                }
                            });
                            
                            // æ¢å¤å½“å‰æ´»è·ƒå·¥ä½œåŒº
                            if (savedCurrentMindmap && mindmaps[savedCurrentMindmap]) {
                                currentMindmap = savedCurrentMindmap;
                                switchMindmapTab(currentMindmap);
                                console.log('âœ… å½“å‰å·¥ä½œåŒºå·²æ¢å¤ä¸º:', currentMindmap);
                            }
                        }
                    } catch (e) {
                        console.error('æ€ç»´å¯¼å›¾æ•°æ®æ¢å¤å¤±è´¥:', e);
                    }
                }
                
                // æ¢å¤èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯æ•°æ®åº“
                if (savedNodeDatabase) {
                    try {
                        nodeDatabase = JSON.parse(savedNodeDatabase);
                        console.log('âœ… èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯å·²æ¢å¤');
                    } catch (e) {
                        console.error('èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯æ¢å¤å¤±è´¥:', e);
                        nodeDatabase = {};
                    }
                }
                
                // æ¢å¤ä¸»é¢˜è®¾ç½®
                if (savedTheme) {
                    try {
                        var themeIndex = parseInt(savedTheme);
                        if (themeIndex >= 0 && themeIndex < themes.length) {
                            currentThemeIndex = themeIndex;
                            jm.set_theme(themes[currentThemeIndex].name);
                            console.log('âœ… ä¸»é¢˜è®¾ç½®å·²æ¢å¤:', themes[currentThemeIndex].label);
                        }
                    } catch (e) {
                        console.error('ä¸»é¢˜è®¾ç½®æ¢å¤å¤±è´¥:', e);
                    }
                }
                
                // æ¢å¤æ‹–æ‹½çŠ¶æ€
                if (savedDragState) {
                    try {
                        isDragEnabled = (savedDragState === 'true');
                        if (isDragEnabled) {
                            jm.enable_draggable_node();
                        } else {
                            jm.disable_draggable_node();
                        }
                        updateDragStatusDisplay();
                        console.log('âœ… æ‹–æ‹½çŠ¶æ€å·²æ¢å¤:', isDragEnabled ? 'å¯ç”¨' : 'ç¦ç”¨');
                    } catch (e) {
                        console.error('æ‹–æ‹½çŠ¶æ€æ¢å¤å¤±è´¥:', e);
                    }
                }
                
                // æ¢å¤é€‰ä¸­èŠ‚ç‚¹
                if (savedSelectedNode && hasRecoveredData) {
                    setTimeout(function() {
                        try {
                            var node = jm.get_node(savedSelectedNode);
                            if (node) {
                                jm.select_node(savedSelectedNode);
                                showNodeDetails(savedSelectedNode);
                                console.log('âœ… é€‰ä¸­èŠ‚ç‚¹å·²æ¢å¤:', node.topic);
                            }
                        } catch (e) {
                            console.error('é€‰ä¸­èŠ‚ç‚¹æ¢å¤å¤±è´¥:', e);
                        }
                    }, 300);
                }
                
                if (hasRecoveredData) {
                    showMessage('ğŸ”„ å·²ä»æœ¬åœ°å­˜å‚¨æ¢å¤ä¸Šæ¬¡çš„æ€ç»´å¯¼å›¾çŠ¶æ€');
                } else {
                    // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ•°æ®ï¼Œåˆå§‹åŒ–é»˜è®¤æ•°æ®
                    initNodeDatabase();
                }
                
                return hasRecoveredData;
                
            } catch (error) {
                console.error('æ•°æ®æ¢å¤å¤±è´¥:', error);
                showMessage('âŒ æ•°æ®æ¢å¤å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
                initNodeDatabase();
                return false;
            }
        }
        
        // æ¸…é™¤ä¿å­˜çš„æ•°æ®
        function clearSavedData() {
            if (confirm('âš ï¸ ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ä¿å­˜çš„æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æœ¬åœ°å­˜å‚¨çš„æ€ç»´å¯¼å›¾ã€ä¸»é¢˜è®¾ç½®ç­‰ä¿¡æ¯ã€‚')) {
                try {
                    Object.values(STORAGE_KEYS).forEach(function(key) {
                        localStorage.removeItem(key);
                    });
                    
                    showMessage('ğŸ—‘ï¸ æœ¬åœ°å­˜å‚¨æ•°æ®å·²æ¸…é™¤');
                    console.log('âœ… æœ¬åœ°å­˜å‚¨æ•°æ®å·²æ¸…é™¤');
                    
                    // é‡æ–°åŠ è½½é»˜è®¤æ•°æ®
                    setTimeout(function() {
                        location.reload();
                    }, 1000);
                    
                } catch (error) {
                    console.error('æ¸…é™¤æ•°æ®å¤±è´¥:', error);
                    showMessage('âŒ æ¸…é™¤æ•°æ®å¤±è´¥: ' + error.message);
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', function() {
            // é¦–å…ˆç¡®ä¿å¤šå·¥ä½œåŒºå·²æ­£ç¡®åˆå§‹åŒ–
            if (!mindmaps.workspace || !mindmaps.knowledge || !mindmaps.project) {
                console.log('é‡æ–°åˆå§‹åŒ–å¤šå·¥ä½œåŒº...');
                initMindmaps();
            }
            
            // å°è¯•åŠ è½½ä¿å­˜çš„æ•°æ®
            var hasRecoveredData = loadSavedData();
            
            // å¦‚æœæ²¡æœ‰æ¢å¤æ•°æ®ï¼Œè¿›è¡Œæ­£å¸¸åˆå§‹åŒ–
            if (!hasRecoveredData) {
                // åˆå§‹åŒ–å½“å‰æ´»è·ƒå·¥ä½œåŒºçš„èŠ‚ç‚¹æ•°æ®åº“
                initNodeDatabase();
                
                // æ˜¾ç¤ºé€‰ä¸­èŠ‚ç‚¹
                updateSelectedNodeDisplay();
                
                // å¦‚æœæœ‰é€‰ä¸­èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
                var selected = getCurrentJsMind().get_selected_node();
                if (selected) {
                    showNodeDetails(selected.id);
                }
            }
            
            // è®¾ç½®è‡ªåŠ¨ä¿å­˜
            setupAutoSave();
            
            showMessage('ğŸ‰ jsMind æœ¬åœ°æ‹–æ‹½æ¼”ç¤ºå·²å¯åŠ¨ï¼');
            console.log('jsMind æœ¬åœ°æ‹–æ‹½ç‰ˆæœ¬æ¼”ç¤ºå·²å¯åŠ¨');
            console.log('ç‰ˆæœ¬: 0.8.7 (æœ¬åœ°ç‰ˆæœ¬)');
            console.log('æ‹–æ‹½åŠŸèƒ½: å·²å¯ç”¨');
            console.log('å½“å‰ä¸»é¢˜:', themes[currentThemeIndex].label);
        });

        // æ•°æ®å¯¼å‡ºåŠŸèƒ½
        function exportToFile() {
            try {
                var mind_data = jm.get_data();
                if (!mind_data) {
                    showMessage('âŒ æ— æ•°æ®å¯å¯¼å‡º');
                    return;
                }
                
                // æ„å»ºå¯¼å‡ºæ•°æ®ï¼ŒåŒ…å«èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯
                var exportData = {
                    mindmap: mind_data,
                    nodeDetails: nodeDatabase,
                    exportInfo: {
                        timestamp: new Date().toISOString(),
                        version: "1.0.0",
                        exported_by: "NodeMind"
                    }
                };
                
                var mind_str = JSON.stringify(exportData, null, 2);
                var filename = (mind_data.meta && mind_data.meta.name) ? mind_data.meta.name : 'mindmap';
                filename = filename.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '_') + '_' + new Date().getTime();
                
                // ä½¿ç”¨ jsMind å·¥å…·ä¿å­˜æ–‡ä»¶
                if (typeof jsMind !== 'undefined' && jsMind.util && jsMind.util.file) {
                    jsMind.util.file.save(mind_str, 'application/json', filename + '.json');
                    showMessage('âœ… JSONæ–‡ä»¶å¯¼å‡ºæˆåŠŸ: ' + filename + '.json');
                } else {
                    // å¤‡ç”¨æ–¹æ¡ˆï¼šæ‰‹åŠ¨åˆ›å»ºä¸‹è½½
                    downloadFile(mind_str, filename + '.json', 'application/json');
                    showMessage('âœ… JSONæ–‡ä»¶å¯¼å‡ºæˆåŠŸ: ' + filename + '.json');
                }
                
                console.log('å¯¼å‡ºæ•°æ®:', exportData);
            } catch (error) {
                console.error('å¯¼å‡ºå¤±è´¥:', error);
                showMessage('âŒ å¯¼å‡ºå¤±è´¥: ' + error.message);
            }
        }
        
        function exportToCustomFile() {
            try {
                var mind_data = jm.get_data();
                if (!mind_data) {
                    showMessage('âŒ æ— æ•°æ®å¯å¯¼å‡º');
                    return;
                }
                
                // å¼¹å‡ºè‡ªå®šä¹‰æ–‡ä»¶åå¯¹è¯æ¡†
                var defaultName = (mind_data.meta && mind_data.meta.name) ? mind_data.meta.name : 'mindmap';
                var customName = prompt('è¯·è¾“å…¥å¯¼å‡ºæ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰:', defaultName);
                
                if (customName === null) {
                    showMessage('ğŸš« å¯¼å‡ºå·²å–æ¶ˆ');
                    return;
                }
                
                if (!customName || customName.trim() === '') {
                    customName = 'mindmap_' + new Date().getTime();
                }
                
                // æ¸…ç†æ–‡ä»¶å
                customName = customName.trim().replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '_');
                
                // æ„å»ºå¯¼å‡ºæ•°æ®
                var exportData = {
                    mindmap: mind_data,
                    nodeDetails: nodeDatabase,
                    exportInfo: {
                        timestamp: new Date().toISOString(),
                        version: "1.0.0",
                        exported_by: "NodeMind",
                        custom_filename: customName
                    }
                };
                
                var mind_str = JSON.stringify(exportData, null, 2);
                
                // ä½¿ç”¨ jsMind å·¥å…·ä¿å­˜æ–‡ä»¶
                if (typeof jsMind !== 'undefined' && jsMind.util && jsMind.util.file) {
                    jsMind.util.file.save(mind_str, 'application/json', customName + '.json');
                    showMessage('âœ… è‡ªå®šä¹‰æ–‡ä»¶å¯¼å‡ºæˆåŠŸ: ' + customName + '.json');
                } else {
                    // å¤‡ç”¨æ–¹æ¡ˆï¼šæ‰‹åŠ¨åˆ›å»ºä¸‹è½½
                    downloadFile(mind_str, customName + '.json', 'application/json');
                    showMessage('âœ… è‡ªå®šä¹‰æ–‡ä»¶å¯¼å‡ºæˆåŠŸ: ' + customName + '.json');
                }
                
                console.log('è‡ªå®šä¹‰å¯¼å‡ºæ•°æ®:', exportData);
            } catch (error) {
                console.error('è‡ªå®šä¹‰å¯¼å‡ºå¤±è´¥:', error);
                showMessage('âŒ è‡ªå®šä¹‰å¯¼å‡ºå¤±è´¥: ' + error.message);
            }
        }
        
        // å¤‡ç”¨ä¸‹è½½å‡½æ•°
        function downloadFile(content, filename, contentType) {
            var blob = new Blob([content], { type: contentType });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // å¿«é€Ÿå¯¼å‡ºï¼ˆä»…æ€ç»´å¯¼å›¾æ•°æ®ï¼‰
        function quickExport() {
            try {
                var mind_data = jm.get_data();
                if (!mind_data) {
                    showMessage('âŒ æ— æ•°æ®å¯å¯¼å‡º');
                    return;
                }
                
                var mind_str = JSON.stringify(mind_data, null, 2);
                var filename = 'mindmap_quick_' + new Date().getTime();
                
                downloadFile(mind_str, filename + '.json', 'application/json');
                showMessage('âš¡ å¿«é€Ÿå¯¼å‡ºæˆåŠŸ: ' + filename + '.json');
                
            } catch (error) {
                console.error('å¿«é€Ÿå¯¼å‡ºå¤±è´¥:', error);
                showMessage('âŒ å¿«é€Ÿå¯¼å‡ºå¤±è´¥: ' + error.message);
            }
        }

        // æ–‡ä»¶å¯¼å…¥åŠŸèƒ½
        function triggerImport() {
            var fileInput = document.getElementById('import_file_input');
            fileInput.click();
        }
        
        function handleFileImport(fileInput) {
            var files = fileInput.files;
            if (files.length > 0) {
                var file = files[0];
                importMindmapFile(file);
            }
        }
        
        function importMindmapFile(file) {
            try {
                var fileName = file.name.toLowerCase();
                
                // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                if (!fileName.endsWith('.json') && !fileName.endsWith('.jm') && !fileName.endsWith('.mm')) {
                    showMessage('âŒ ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œä»…æ”¯æŒ .jsonã€.jmã€.mm æ–‡ä»¶');
                    return;
                }
                
                showMessage('ğŸ“‚ æ­£åœ¨å¯¼å…¥æ–‡ä»¶: ' + file.name);
                
                // ä½¿ç”¨ jsMind å·¥å…·è¯»å–æ–‡ä»¶
                if (typeof jsMind !== 'undefined' && jsMind.util && jsMind.util.file) {
                    jsMind.util.file.read(file, function(fileData, fileName) {
                        try {
                            processMindmapData(fileData, fileName, file.name);
                        } catch (error) {
                            console.error('æ–‡ä»¶å¤„ç†å¤±è´¥:', error);
                            showMessage('âŒ æ–‡ä»¶å¤„ç†å¤±è´¥: ' + error.message);
                        }
                    });
                } else {
                    // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨ FileReader
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            processMindmapData(e.target.result, file.name, file.name);
                        } catch (error) {
                            console.error('æ–‡ä»¶è¯»å–å¤±è´¥:', error);
                            showMessage('âŒ æ–‡ä»¶è¯»å–å¤±è´¥: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
                
            } catch (error) {
                console.error('å¯¼å…¥å¤±è´¥:', error);
                showMessage('âŒ å¯¼å…¥å¤±è´¥: ' + error.message);
            }
        }
        
        function processMindmapData(fileData, fileName, originalFileName) {
            try {
                var mind = null;
                var fileExtension = originalFileName.toLowerCase().split('.').pop();
                
                if (fileExtension === 'mm') {
                    // FreeMind æ ¼å¼
                    var mindName = fileName;
                    if (/.*\.mm$/.test(mindName)) {
                        mindName = fileName.substring(0, fileName.length - 3);
                    }
                    
                    mind = {
                        meta: {
                            name: mindName,
                            author: 'NodeMind Imported',
                            version: '1.0.0',
                        },
                        format: 'freemind',
                        data: fileData,
                    };
                } else {
                    // JSON æˆ– JM æ ¼å¼
                    if (typeof fileData === 'string') {
                        mind = JSON.parse(fileData);
                    } else {
                        mind = fileData;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯æˆ‘ä»¬å¯¼å‡ºçš„å®Œæ•´æ ¼å¼
                    if (mind && mind.mindmap && mind.nodeDetails) {
                        // æ¢å¤èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯
                        nodeDatabase = mind.nodeDetails || {};
                        mind = mind.mindmap;
                        showMessage('ğŸ“‹ æ£€æµ‹åˆ°å®Œæ•´æ•°æ®æ ¼å¼ï¼Œæ­£åœ¨æ¢å¤èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯...');
                    }
                    
                    // éªŒè¯æ•°æ®æ ¼å¼
                    if (!mind || !mind.data) {
                        throw new Error('æ— æ•ˆçš„æ€ç»´å¯¼å›¾æ•°æ®æ ¼å¼');
                    }
                }
                
                // æ˜¾ç¤ºæ€ç»´å¯¼å›¾
                if (mind) {
                    jm.show(mind);
                    
                    // é‡æ–°åˆå§‹åŒ–èŠ‚ç‚¹æ•°æ®åº“ï¼ˆå¦‚æœæ²¡æœ‰ä»æ–‡ä»¶ä¸­æ¢å¤ï¼‰
                    if (!mind.nodeDetails) {
                        setTimeout(function() {
                            initNodeDatabase();
                        }, 100);
                    }
                    
                    showMessage('âœ… æ–‡ä»¶å¯¼å…¥æˆåŠŸ: ' + originalFileName);
                    console.log('å¯¼å…¥çš„æ€ç»´å¯¼å›¾æ•°æ®:', mind);
                    
                    // æ›´æ–°ä¸»é¢˜æ˜¾ç¤º
                    updateSelectedNodeDisplay();
                    
                    // å¦‚æœæœ‰æ ¹èŠ‚ç‚¹ï¼Œé€‰æ‹©å®ƒ
                    setTimeout(function() {
                        var rootNode = jm.get_node(jm.get_root().id);
                        if (rootNode) {
                            jm.select_node(rootNode.id);
                        }
                    }, 200);
                    
                } else {
                    throw new Error('æ— æ³•è§£ææ€ç»´å¯¼å›¾æ•°æ®');
                }
                
            } catch (error) {
                console.error('æ•°æ®å¤„ç†å¤±è´¥:', error);
                showMessage('âŒ æ•°æ®å¤„ç†å¤±è´¥: ' + error.message);
            }
            
            // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
            document.getElementById('import_file_input').value = '';
        }
        
        // é‡ç½®æ€ç»´å¯¼å›¾
        function resetMindmap() {
            if (confirm('âš ï¸ ç¡®å®šè¦é‡ç½®æ€ç»´å¯¼å›¾å—ï¼Ÿå½“å‰æ‰€æœ‰æ•°æ®å°†ä¸¢å¤±ï¼')) {
                jm.show(mindData);
                nodeDatabase = {};
                initNodeDatabase();
                showMessage('ğŸ”„ æ€ç»´å¯¼å›¾å·²é‡ç½®');
            }
        }
        
        // æ˜¾ç¤ºä½¿ç”¨æŒ‡å—
        function showUserGuide() {
            var guideWindow = window.open('', '_blank', 'width=1000,height=700,scrollbars=yes,resizable=yes');
            var guideContent = `
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NodeMind ä½¿ç”¨æŒ‡å—</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 { 
            color: #2c3e50; 
            text-align: center; 
            font-size: 32px; 
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
        }
        h2 { 
            color: #34495e; 
            font-size: 24px; 
            margin-top: 30px; 
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid #3498db;
        }
        h3 { 
            color: #2c3e50; 
            font-size: 18px; 
            margin-top: 20px; 
            margin-bottom: 10px;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #28a745;
        }
        .feature-card h4 {
            color: #2c3e50;
            margin: 0 0 15px 0;
            font-size: 16px;
        }
        ul { 
            margin: 10px 0; 
            padding-left: 20px; 
        }
        li { 
            margin: 8px 0; 
            font-size: 14px;
        }
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        .shortcut-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .shortcut-table th, .shortcut-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        .shortcut-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        .shortcut-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        .btn-guide {
            background: #007bff;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            margin: 5px;
            cursor: pointer;
        }
        .emoji { font-size: 18px; }
        .version-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š NodeMind ä½¿ç”¨æŒ‡å—</h1>
        
        <div class="version-info">
            <strong>ğŸ¯ NodeMind v1.0.0</strong> - åŸºäº jsMind çš„æ™ºèƒ½æ€ç»´å¯¼å›¾å·¥å…·
            <br>
            <small>æ”¯æŒæ‹–æ‹½ã€å¯¼å…¥å¯¼å‡ºã€æŒä¹…åŒ–å­˜å‚¨çš„å…¨åŠŸèƒ½æ€ç»´å¯¼å›¾åº”ç”¨</small>
        </div>

        <h2>ğŸš€ å¿«é€Ÿå¼€å§‹</h2>
        <div class="highlight">
            <strong>ğŸ’¡ æç¤ºï¼š</strong> NodeMind æ”¯æŒå®Œå…¨çš„é”®ç›˜æ“ä½œï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½å¯ä»¥é€šè¿‡å¿«æ·é”®å¿«é€Ÿè®¿é—®ï¼
        </div>

        <h2>âŒ¨ï¸ å¿«æ·é”®æŒ‡å—</h2>
        <table class="shortcut-table">
            <thead>
                <tr>
                    <th>åŠŸèƒ½åˆ†ç±»</th>
                    <th>å¿«æ·é”®</th>
                    <th>è¯´æ˜</th>
                </tr>
            </thead>
            <tbody>
                <tr><td rowspan="6"><strong>èŠ‚ç‚¹æ“ä½œ</strong></td><td>Ctrl+Enter</td><td>æ·»åŠ å­èŠ‚ç‚¹</td></tr>
                <tr><td>Enter</td><td>æ·»åŠ å…„å¼ŸèŠ‚ç‚¹</td></tr>
                <tr><td>F2</td><td>ç¼–è¾‘èŠ‚ç‚¹å†…å®¹</td></tr>
                <tr><td>Delete</td><td>åˆ é™¤èŠ‚ç‚¹</td></tr>
                <tr><td>Space</td><td>å±•å¼€/æ”¶èµ·èŠ‚ç‚¹</td></tr>
                <tr><td>æ–¹å‘é”®</td><td>é€‰æ‹©ç›¸é‚»èŠ‚ç‚¹</td></tr>
                
                <tr><td rowspan="4"><strong>æ–‡ä»¶æ“ä½œ</strong></td><td>Ctrl+S</td><td>å¯¼å‡ºå®Œæ•´JSONæ–‡ä»¶</td></tr>
                <tr><td>Ctrl+E</td><td>è‡ªå®šä¹‰æ–‡ä»¶åå¯¼å‡º</td></tr>
                <tr><td>Ctrl+Q</td><td>å¿«é€Ÿå¯¼å‡º</td></tr>
                <tr><td>Ctrl+O</td><td>å¯¼å…¥æ–‡ä»¶</td></tr>
                
                <tr><td rowspan="1"><strong>å¸®åŠ©</strong></td><td>Ctrl+H</td><td>æ˜¾ç¤ºå¿«æ·é”®å¸®åŠ©</td></tr>
            </tbody>
        </table>

        <h2>ğŸ¨ æ ¸å¿ƒåŠŸèƒ½</h2>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>ğŸ§  æ€ç»´å¯¼å›¾ç¼–è¾‘</h4>
                <ul>
                    <li>æ‹–æ‹½èŠ‚ç‚¹é‡æ–°ç»„ç»‡ç»“æ„</li>
                    <li>æ”¯æŒè·¨åˆ†æ”¯æ‹–æ‹½ç§»åŠ¨</li>
                    <li>å®æ—¶è‡ªåŠ¨å¸ƒå±€è°ƒæ•´</li>
                    <li>å¤šç§èŠ‚ç‚¹ç¼–è¾‘æ–¹å¼</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h4>ğŸ’¾ æ•°æ®ç®¡ç†</h4>
                <ul>
                    <li>è‡ªåŠ¨æŒä¹…åŒ–å­˜å‚¨</li>
                    <li>æ”¯æŒJSON/JM/MMæ ¼å¼</li>
                    <li>å®Œæ•´çš„å¯¼å…¥å¯¼å‡ºåŠŸèƒ½</li>
                    <li>é¡µé¢å…³é—­æ•°æ®ä¿æŠ¤</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h4>ğŸ­ ç•Œé¢ä¸»é¢˜</h4>
                <ul>
                    <li>15ç§å†…ç½®ä¸»é¢˜</li>
                    <li>ä¸»é¢˜è®¾ç½®è‡ªåŠ¨ä¿å­˜</li>
                    <li>å“åº”å¼è®¾è®¡</li>
                    <li>ç§»åŠ¨ç«¯å®Œç¾æ”¯æŒ</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h4>ğŸ“‹ èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯</h4>
                <ul>
                    <li>ä¸°å¯Œçš„èŠ‚ç‚¹å±æ€§ç¼–è¾‘</li>
                    <li>åˆ†ç±»æ ‡ç­¾ç®¡ç†</li>
                    <li>æ—¶é—´æˆ³è®°å½•</li>
                    <li>èŠ‚ç‚¹å…³ç³»æ˜¾ç¤º</li>
                </ul>
            </div>
        </div>

        <h2>ğŸ–±ï¸ é¼ æ ‡æ“ä½œæŒ‡å—</h2>
        <ul>
            <li><strong>å•å‡»èŠ‚ç‚¹</strong> - é€‰ä¸­èŠ‚ç‚¹</li>
            <li><strong>åŒå‡»èŠ‚ç‚¹</strong> - ç¼–è¾‘èŠ‚ç‚¹å†…å®¹</li>
            <li><strong>æ‹–æ‹½ç”»å¸ƒ</strong> - ç§»åŠ¨è§†å›¾</li>
            <li><strong>æ»šè½®</strong> - ç¼©æ”¾æ€ç»´å¯¼å›¾</li>
            <li><strong>æ‹–æ‹½èŠ‚ç‚¹</strong> - é‡æ–°ç»„ç»‡ç»“æ„</li>
        </ul>

        <h2>ğŸ”„ æ•°æ®æŒä¹…åŒ–</h2>
        <p>NodeMind å…·å¤‡å®Œæ•´çš„è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ï¼š</p>
        <ul>
            <li><strong>å®æ—¶ä¿å­˜</strong> - æ‰€æœ‰æ“ä½œè‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨</li>
            <li><strong>çŠ¶æ€æ¢å¤</strong> - é¡µé¢é‡æ–°åŠ è½½æ—¶è‡ªåŠ¨æ¢å¤å·¥ä½œçŠ¶æ€</li>
            <li><strong>å¤šå±‚ä¿æŠ¤</strong> - é¡µé¢å…³é—­å‰å¼ºåˆ¶ä¿å­˜</li>
            <li><strong>æ•°æ®ç®¡ç†</strong> - æ”¯æŒæ‰‹åŠ¨æ¸…é™¤å­˜å‚¨æ•°æ®</li>
        </ul>

        <h2>ğŸ“ æ–‡ä»¶æ ¼å¼æ”¯æŒ</h2>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>ğŸ“„ å¯¼å…¥æ ¼å¼</h4>
                <ul>
                    <li><strong>.json</strong> - æ ‡å‡†JSONæ ¼å¼</li>
                    <li><strong>.jm</strong> - jsMindåŸç”Ÿæ ¼å¼</li>
                    <li><strong>.mm</strong> - FreeMindæ ¼å¼</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h4>ğŸ’¾ å¯¼å‡ºé€‰é¡¹</h4>
                <ul>
                    <li><strong>å®Œæ•´å¯¼å‡º</strong> - åŒ…å«æ‰€æœ‰èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯</li>
                    <li><strong>è‡ªå®šä¹‰å¯¼å‡º</strong> - ç”¨æˆ·æŒ‡å®šæ–‡ä»¶å</li>
                    <li><strong>å¿«é€Ÿå¯¼å‡º</strong> - ä»…æ ¸å¿ƒæ€ç»´å¯¼å›¾æ•°æ®</li>
                </ul>
            </div>
        </div>

        <h2>ğŸ› ï¸ é«˜çº§æŠ€å·§</h2>
        <div class="highlight">
            <h3>ğŸ’¡ æ•ˆç‡æå‡æŠ€å·§</h3>
            <ul>
                <li><strong>æ‰¹é‡æ“ä½œ</strong> - ä½¿ç”¨Ctrl+å¿«æ·é”®å¿«é€Ÿæ“ä½œ</li>
                <li><strong>æ‹–æ‹½é‡ç»„</strong> - ç›´æ¥æ‹–æ‹½èŠ‚ç‚¹æ”¹å˜ç»“æ„</li>
                <li><strong>ä¸»é¢˜åˆ‡æ¢</strong> - ä¸åŒåœºæ™¯ä½¿ç”¨ä¸åŒä¸»é¢˜</li>
                <li><strong>æ ‡ç­¾ç®¡ç†</strong> - ä½¿ç”¨æ ‡ç­¾åˆ†ç±»ç®¡ç†èŠ‚ç‚¹</li>
            </ul>
        </div>

        <h2>ğŸš¨ å¸¸è§é—®é¢˜</h2>
        <h3>Q: é¡µé¢åˆ·æ–°åæ•°æ®ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ</h3>
        <p>A: NodeMind å…·å¤‡è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ï¼Œæ•°æ®ä¼šè‡ªåŠ¨æ¢å¤ã€‚å¦‚æœä»æœ‰é—®é¢˜ï¼Œå¯èƒ½æ˜¯æµè§ˆå™¨ç¦ç”¨äº†æœ¬åœ°å­˜å‚¨ã€‚</p>
        
        <h3>Q: æ”¯æŒå“ªäº›æµè§ˆå™¨ï¼Ÿ</h3>
        <p>A: æ”¯æŒæ‰€æœ‰ç°ä»£æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Safariã€Edgeç­‰ï¼‰ï¼Œå»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ã€‚</p>
        
        <h3>Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ</h3>
        <p>A: ä½¿ç”¨ Ctrl+S å¯¼å‡ºå®Œæ•´æ•°æ®ï¼ŒåŒ…å«æ‰€æœ‰èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä½œä¸ºå®Œæ•´å¤‡ä»½ã€‚</p>

        <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee;">
            <p><strong>ğŸ‰ å¼€å§‹ä½¿ç”¨ NodeMindï¼Œè®©æ€ç»´å¯è§†åŒ–ï¼</strong></p>
            <button class="btn-guide" onclick="window.close()">å…³é—­æŒ‡å—</button>
        </div>
    </div>
</body>
</html>`;
            
            guideWindow.document.write(guideContent);
            guideWindow.document.close();
            guideWindow.focus();
            
            showMessage('ğŸ“š ä½¿ç”¨æŒ‡å—å·²æ‰“å¼€');
        }

        // æ–°å†…å®¹åŠŸèƒ½ - ä¿å­˜å½“å‰è„‘å›¾å¹¶åˆ›å»ºç©ºç™½è„‘å›¾
        function createNewContent() {
            try {
                // 1. å…ˆä¿å­˜å½“å‰è„‘å›¾
                var currentMind = getCurrentJsMind();
                if (currentMind) {
                    var mind_data = currentMind.get_data();
                    if (mind_data) {
                        // ç”Ÿæˆæ—¶é—´æˆ³æ–‡ä»¶å
                        var timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19);
                        var backupName = 'mindmap_backup_' + timestamp;
                        
                        // æ„å»ºä¿å­˜æ•°æ®
                        var exportData = {
                            mindmap: mind_data,
                            nodeDetails: nodeDatabase,
                            exportInfo: {
                                timestamp: new Date().toISOString(),
                                version: "1.0.0",
                                exported_by: "NodeMind",
                                backup_type: "auto_before_new_content"
                            }
                        };
                        
                        var mind_str = JSON.stringify(exportData, null, 2);
                        
                        // è‡ªåŠ¨ä¿å­˜å¤‡ä»½æ–‡ä»¶
                        if (typeof jsMind !== 'undefined' && jsMind.util && jsMind.util.file) {
                            jsMind.util.file.save(mind_str, 'application/json', backupName + '.json');
                        } else {
                            // å¤‡ç”¨æ–¹æ¡ˆ
                            downloadFile(mind_str, backupName + '.json', 'application/json');
                        }
                        
                        showMessage('âœ… å·²ä¿å­˜å½“å‰è„‘å›¾: ' + backupName + '.json');
                    }
                }
                
                // 2. åˆ›å»ºæ–°çš„ç©ºç™½è„‘å›¾æ•°æ®
                var newMindData = {
                    meta: {
                        name: "æ–°å†…å®¹è„‘å›¾",
                        author: "NodeMind",
                        version: "1.0.0"
                    },
                    format: "node_tree",
                    data: {
                        id: "new_root_" + Date.now(),
                        topic: "ğŸ§  ä¸­å¿ƒèŠ‚ç‚¹",
                        children: []
                    }
                };
                
                // 3. æ›´æ–°å½“å‰æ´»è·ƒè„‘å›¾
                var currentMindmap = getCurrentJsMind();
                if (currentMindmap) {
                    currentMindmap.show(newMindData);
                    
                    // 4. æ¸…ç©ºèŠ‚ç‚¹æ•°æ®åº“
                    nodeDatabase = {};
                    
                    // 5. åˆå§‹åŒ–æ–°çš„æ ¹èŠ‚ç‚¹æ•°æ®
                    nodeDatabase[newMindData.data.id] = {
                        id: newMindData.data.id,
                        title: newMindData.data.topic,
                        content: '',
                        relations: {
                            parent: null,
                            children: []
                        },
                        tags: {
                            categories: [],
                            technical: [],
                            status: []
                        },
                        time: {
                            created: new Date().toLocaleString(),
                            updated: new Date().toLocaleString()
                        },
                        details: {
                            description: '',
                            implementation: '',
                            testing: '',
                            notes: ''
                        }
                    };
                    
                    // 6. æ¸…ç©ºè¯¦æƒ…é¢æ¿
                    document.getElementById('detail-info-content').innerHTML = `
                        <div class="empty-state">
                            <div class="icon">ğŸ“</div>
                            <div>ç‚¹å‡»æ€ç»´å¯¼å›¾ä¸­çš„èŠ‚ç‚¹ç¼–è¾‘è¯¦ç»†æè¿°</div>
                        </div>
                    `;
                    
                    document.getElementById('basic-info-content').innerHTML = `
                        <div class="empty-state">
                            <div class="icon">ğŸ“‹</div>
                            <div>ç‚¹å‡»æ€ç»´å¯¼å›¾ä¸­çš„èŠ‚ç‚¹æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯</div>
                        </div>
                    `;
                    
                    document.getElementById('history-info-content').innerHTML = `
                        <div class="empty-state">
                            <div class="icon">ğŸ“š</div>
                            <div>ç‚¹å‡»æ€ç»´å¯¼å›¾ä¸­çš„èŠ‚ç‚¹æŸ¥çœ‹å†å²è®°å½•</div>
                        </div>
                    `;
                    
                    // 7. æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                    document.getElementById('selectedNode').textContent = 'æ— ';
                    
                    // 8. è‡ªåŠ¨ä¿å­˜æ–°çŠ¶æ€
                    setTimeout(function() {
                        autoSaveData();
                    }, 500);
                    
                    showMessage('âœ¨ æ–°å†…å®¹è„‘å›¾å·²åˆ›å»ºï¼ä¸­å¿ƒèŠ‚ç‚¹å·²å‡†å¤‡å°±ç»ª');
                    console.log('æ–°å†…å®¹è„‘å›¾åˆ›å»ºå®Œæˆ');
                }
                
            } catch (error) {
                console.error('åˆ›å»ºæ–°å†…å®¹å¤±è´¥:', error);
                showMessage('âŒ åˆ›å»ºæ–°å†…å®¹å¤±è´¥: ' + error.message);
            }
        }

        // æ·»åŠ é”®ç›˜å¿«æ·é”®å’Œå¸®åŠ©
        document.addEventListener('keydown', function(e) {
            // å¯¼å‡ºåŠŸèƒ½å¿«æ·é”®
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                exportToFile();
                return;
            }
            
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                exportToCustomFile();
                return;
            }
            
            if (e.ctrlKey && e.key === 'q') {
                e.preventDefault();
                quickExport();
                return;
            }
            
            if (e.ctrlKey && e.key === 'o') {
                e.preventDefault();
                triggerImport();
                return;
            }
            
            // å¸®åŠ©å¿«æ·é”®
            if (e.ctrlKey && e.key === 'h') {
                e.preventDefault();
                                 alert('jsMind æ‹–æ‹½æ¼”ç¤º - å¿«æ·é”®å¸®åŠ©:\n\nåŸºæœ¬æ“ä½œ:\nâ€¢ Ctrl+Enter - æ·»åŠ å­èŠ‚ç‚¹\nâ€¢ Enter - æ·»åŠ å…„å¼ŸèŠ‚ç‚¹\nâ€¢ F2 - ç¼–è¾‘èŠ‚ç‚¹å†…å®¹\nâ€¢ Delete - åˆ é™¤èŠ‚ç‚¹\nâ€¢ Space - å±•å¼€/æ”¶èµ·èŠ‚ç‚¹\nâ€¢ æ–¹å‘é”® - é€‰æ‹©ç›¸é‚»èŠ‚ç‚¹\n\næ–‡ä»¶æ“ä½œ:\nâ€¢ Ctrl+S - å¯¼å‡ºå®Œæ•´JSONæ–‡ä»¶\nâ€¢ Ctrl+E - è‡ªå®šä¹‰æ–‡ä»¶åå¯¼å‡º\nâ€¢ Ctrl+Q - å¿«é€Ÿå¯¼å‡ºï¼ˆä»…æ€ç»´å¯¼å›¾æ•°æ®ï¼‰\nâ€¢ Ctrl+O - å¯¼å…¥æ–‡ä»¶ï¼ˆæ”¯æŒJSON/JM/MMæ ¼å¼ï¼‰\n\næ‹–æ‹½æ“ä½œ:\nâ€¢ é¼ æ ‡å·¦é”®æ‹–æ‹½èŠ‚ç‚¹ç§»åŠ¨\nâ€¢ æ‹–æ‹½åˆ°ç›®æ ‡èŠ‚ç‚¹ä¸Šé‡Šæ”¾\nâ€¢ æ”¯æŒè·¨åˆ†æ”¯æ‹–æ‹½\nâ€¢ å®æ—¶è§†è§‰åé¦ˆ\n\nCtrl+H - æ˜¾ç¤ºæ­¤å¸®åŠ©');
            }
        });
    </script>
</body>
</html> 