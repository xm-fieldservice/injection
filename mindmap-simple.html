<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€æ˜“æ€ç»´å¯¼å›¾</title>
    <style>
        body {
            margin: 0;
            padding: 10px;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: calc(100vh - 20px);
            display: flex;
            flex-direction: column;
        }
        
        .toolbar {
            background: #f8f9fa;
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            gap: 10px;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #1e7e34; }
        
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        
        .mindmap-area {
            flex: 1;
            position: relative;
            overflow: auto;
            background: #ffffff;
        }
        
        .mindmap-canvas {
            width: 100%;
            height: 100%;
            position: relative;
            min-height: 600px;
        }
        
        .node {
            position: absolute;
            background: #fff;
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            user-select: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
            font-size: 14px;
            min-width: 80px;
            text-align: center;
        }
        
        .node:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transform: translateY(-2px);
        }
        
        .node.selected {
            border-color: #dc3545;
            background: #fff5f5;
        }
        
        .node.root {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #5a6cf3;
            font-weight: bold;
            font-size: 16px;
        }
        
        .node.level-1 {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        
        .node.level-2 {
            background: #f3e5f5;
            border-color: #9c27b0;
        }
        
        .connection {
            position: absolute;
            border-top: 2px solid #666;
            z-index: 1;
        }
        
        .status-bar {
            background: #f8f9fa;
            padding: 8px 15px;
            border-top: 1px solid #dee2e6;
            font-size: 12px;
            color: #6c757d;
        }
        
        .edit-input {
            position: absolute;
            border: 2px solid #007bff;
            border-radius: 4px;
            padding: 8px;
            font-size: 14px;
            z-index: 100;
            background: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="toolbar">
            <button class="btn" onclick="addChildNode()">â• æ·»åŠ å­èŠ‚ç‚¹</button>
            <button class="btn btn-success" onclick="addSiblingNode()">â†”ï¸ æ·»åŠ å…„å¼ŸèŠ‚ç‚¹</button>
            <button class="btn" onclick="editNode()">âœï¸ ç¼–è¾‘èŠ‚ç‚¹</button>
            <!-- åˆ é™¤å’Œé‡ç½®æŒ‰é”®å·²ç§»é™¤ - æŒ‰ç…§ç”¨æˆ·è¦æ±‚ç®€åŒ–ç•Œé¢ -->
        </div>
        
        <div class="mindmap-area">
            <div class="mindmap-canvas" id="mindmap-canvas"></div>
        </div>
        
        <div class="status-bar">
            <span>é€‰ä¸­èŠ‚ç‚¹: </span><span id="selectedNode">ä¸­å¿ƒä¸»é¢˜</span>
            <span style="margin-left: 20px;">èŠ‚ç‚¹æ€»æ•°: </span><span id="nodeCount">5</span>
        </div>
    </div>

    <script>
        // æ€ç»´å¯¼å›¾æ•°æ®ç»“æ„
        let mindmapData = {
            id: 'root',
            text: 'ğŸ§  ä¸­å¿ƒä¸»é¢˜',
            x: 400,
            y: 250,
            level: 0,
            children: [
                {
                    id: 'idea1',
                    text: 'ğŸ’¡ æƒ³æ³•åˆ†æ”¯',
                    x: 200,
                    y: 150,
                    level: 1,
                    children: [
                        { id: 'idea1-1', text: 'å…·ä½“æƒ³æ³•1', x: 80, y: 100, level: 2, children: [] },
                        { id: 'idea1-2', text: 'å…·ä½“æƒ³æ³•2', x: 80, y: 200, level: 2, children: [] }
                    ]
                },
                {
                    id: 'plan1',
                    text: 'ğŸ“‹ è®¡åˆ’åˆ†æ”¯',
                    x: 600,
                    y: 150,
                    level: 1,
                    children: [
                        { id: 'plan1-1', text: 'æ­¥éª¤1', x: 720, y: 100, level: 2, children: [] },
                        { id: 'plan1-2', text: 'æ­¥éª¤2', x: 720, y: 200, level: 2, children: [] }
                    ]
                }
            ]
        };

        let selectedNode = null;
        let nodeIdCounter = 100;

        // åˆå§‹åŒ–æ€ç»´å¯¼å›¾
        function initMindmap() {
            renderMindmap();
            selectNode('root');
            updateStatus();
        }

        // æ¸²æŸ“æ€ç»´å¯¼å›¾
        function renderMindmap() {
            const canvas = document.getElementById('mindmap-canvas');
            canvas.innerHTML = '';
            
            // æ¸²æŸ“è¿æ¥çº¿
            renderConnections(mindmapData, canvas);
            
            // æ¸²æŸ“èŠ‚ç‚¹
            renderNodes(mindmapData, canvas);
        }

        // æ¸²æŸ“èŠ‚ç‚¹
        function renderNodes(node, canvas) {
            // åˆ›å»ºèŠ‚ç‚¹å…ƒç´ 
            const nodeElement = document.createElement('div');
            nodeElement.className = `node level-${node.level}`;
            if (node.level === 0) nodeElement.classList.add('root');
            nodeElement.id = `node-${node.id}`;
            nodeElement.style.left = node.x + 'px';
            nodeElement.style.top = node.y + 'px';
            nodeElement.textContent = node.text;
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            nodeElement.onclick = () => selectNode(node.id);
            nodeElement.ondblclick = () => editNodeText(node.id);
            
            canvas.appendChild(nodeElement);
            
            // é€’å½’æ¸²æŸ“å­èŠ‚ç‚¹
            if (node.children) {
                node.children.forEach(child => renderNodes(child, canvas));
            }
        }

        // æ¸²æŸ“è¿æ¥çº¿
        function renderConnections(node, canvas) {
            if (node.children) {
                node.children.forEach(child => {
                    const line = document.createElement('div');
                    line.className = 'connection';
                    
                    const x1 = node.x + 50; // èŠ‚ç‚¹ä¸­å¿ƒ
                    const y1 = node.y + 20;
                    const x2 = child.x + 50;
                    const y2 = child.y + 20;
                    
                    const length = Math.sqrt((x2-x1)**2 + (y2-y1)**2);
                    const angle = Math.atan2(y2-y1, x2-x1) * 180 / Math.PI;
                    
                    line.style.left = x1 + 'px';
                    line.style.top = y1 + 'px';
                    line.style.width = length + 'px';
                    line.style.transformOrigin = '0 0';
                    line.style.transform = `rotate(${angle}deg)`;
                    
                    canvas.appendChild(line);
                    
                    // é€’å½’æ¸²æŸ“å­è¿æ¥
                    renderConnections(child, canvas);
                });
            }
        }

        // é€‰æ‹©èŠ‚ç‚¹
        function selectNode(nodeId) {
            // ç§»é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.node').forEach(n => n.classList.remove('selected'));
            
            // é€‰æ‹©æ–°èŠ‚ç‚¹
            const nodeElement = document.getElementById(`node-${nodeId}`);
            if (nodeElement) {
                nodeElement.classList.add('selected');
                selectedNode = findNodeById(mindmapData, nodeId);
                updateStatus();
            }
        }

        // æŸ¥æ‰¾èŠ‚ç‚¹
        function findNodeById(node, id) {
            if (node.id === id) return node;
            if (node.children) {
                for (let child of node.children) {
                    const found = findNodeById(child, id);
                    if (found) return found;
                }
            }
            return null;
        }

        // æ·»åŠ å­èŠ‚ç‚¹
        function addChildNode() {
            if (!selectedNode) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                return;
            }
            
            const text = prompt('è¯·è¾“å…¥å­èŠ‚ç‚¹å†…å®¹:', 'æ–°å­èŠ‚ç‚¹');
            if (!text) return;
            
            const newNode = {
                id: 'node_' + (++nodeIdCounter),
                text: text,
                x: selectedNode.x + (selectedNode.level === 0 ? 200 : 100),
                y: selectedNode.y + selectedNode.children.length * 80,
                level: selectedNode.level + 1,
                children: []
            };
            
            if (!selectedNode.children) selectedNode.children = [];
            selectedNode.children.push(newNode);
            
            renderMindmap();
            selectNode(newNode.id);
            updateStatus();
        }

        // æ·»åŠ å…„å¼ŸèŠ‚ç‚¹
        function addSiblingNode() {
            if (!selectedNode || selectedNode.level === 0) {
                alert('æ ¹èŠ‚ç‚¹ä¸èƒ½æ·»åŠ å…„å¼ŸèŠ‚ç‚¹');
                return;
            }
            
            const text = prompt('è¯·è¾“å…¥å…„å¼ŸèŠ‚ç‚¹å†…å®¹:', 'æ–°å…„å¼ŸèŠ‚ç‚¹');
            if (!text) return;
            
            const parent = findParentNode(mindmapData, selectedNode.id);
            if (!parent) return;
            
            const newNode = {
                id: 'node_' + (++nodeIdCounter),
                text: text,
                x: selectedNode.x,
                y: selectedNode.y + 80,
                level: selectedNode.level,
                children: []
            };
            
            parent.children.push(newNode);
            repositionNodes();
            renderMindmap();
            selectNode(newNode.id);
            updateStatus();
        }

        // æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹
        function findParentNode(node, childId) {
            if (node.children) {
                for (let child of node.children) {
                    if (child.id === childId) return node;
                    const found = findParentNode(child, childId);
                    if (found) return found;
                }
            }
            return null;
        }

        // ç¼–è¾‘èŠ‚ç‚¹
        function editNode() {
            if (!selectedNode) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                return;
            }
            editNodeText(selectedNode.id);
        }

        // ç¼–è¾‘èŠ‚ç‚¹æ–‡æœ¬
        function editNodeText(nodeId) {
            const node = findNodeById(mindmapData, nodeId);
            if (!node) return;
            
            const newText = prompt('è¯·è¾“å…¥æ–°çš„èŠ‚ç‚¹å†…å®¹:', node.text);
            if (newText && newText.trim()) {
                node.text = newText.trim();
                renderMindmap();
                selectNode(nodeId);
                updateStatus();
            }
        }

        // åˆ é™¤èŠ‚ç‚¹
        function deleteNode() {
            if (!selectedNode) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                return;
            }
            
            if (selectedNode.level === 0) {
                alert('ä¸èƒ½åˆ é™¤æ ¹èŠ‚ç‚¹');
                return;
            }
            
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªèŠ‚ç‚¹å—ï¼Ÿ')) return;
            
            const parent = findParentNode(mindmapData, selectedNode.id);
            if (parent) {
                parent.children = parent.children.filter(child => child.id !== selectedNode.id);
                repositionNodes();
                renderMindmap();
                selectNode('root');
                updateStatus();
            }
        }

        // é‡æ–°å®šä½èŠ‚ç‚¹
        function repositionNodes() {
            function repositionNode(node, baseX, baseY) {
                node.x = baseX;
                node.y = baseY;
                
                if (node.children && node.children.length > 0) {
                    const childSpacing = 80;
                    const totalHeight = (node.children.length - 1) * childSpacing;
                    const startY = baseY - totalHeight / 2;
                    
                    node.children.forEach((child, index) => {
                        const childX = baseX + (node.level === 0 ? 200 : 150);
                        const childY = startY + index * childSpacing;
                        repositionNode(child, childX, childY);
                    });
                }
            }
            
            repositionNode(mindmapData, 400, 250);
        }

        // é‡ç½®æ€ç»´å¯¼å›¾
        function resetMindmap() {
            if (!confirm('ç¡®å®šè¦é‡ç½®æ€ç»´å¯¼å›¾å—ï¼Ÿ')) return;
            
            mindmapData = {
                id: 'root',
                text: 'ğŸ§  ä¸­å¿ƒä¸»é¢˜',
                x: 400,
                y: 250,
                level: 0,
                children: [
                    {
                        id: 'idea1',
                        text: 'ğŸ’¡ æƒ³æ³•åˆ†æ”¯',
                        x: 200,
                        y: 150,
                        level: 1,
                        children: [
                            { id: 'idea1-1', text: 'å…·ä½“æƒ³æ³•1', x: 80, y: 100, level: 2, children: [] },
                            { id: 'idea1-2', text: 'å…·ä½“æƒ³æ³•2', x: 80, y: 200, level: 2, children: [] }
                        ]
                    },
                    {
                        id: 'plan1',
                        text: 'ğŸ“‹ è®¡åˆ’åˆ†æ”¯',
                        x: 600,
                        y: 150,
                        level: 1,
                        children: [
                            { id: 'plan1-1', text: 'æ­¥éª¤1', x: 720, y: 100, level: 2, children: [] },
                            { id: 'plan1-2', text: 'æ­¥éª¤2', x: 720, y: 200, level: 2, children: [] }
                        ]
                    }
                ]
            };
            
            renderMindmap();
            selectNode('root');
            updateStatus();
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            document.getElementById('selectedNode').textContent = selectedNode ? selectedNode.text : 'æ— ';
            document.getElementById('nodeCount').textContent = countNodes(mindmapData);
        }

        // è®¡ç®—èŠ‚ç‚¹æ•°é‡
        function countNodes(node) {
            let count = 1;
            if (node.children) {
                count += node.children.reduce((sum, child) => sum + countNodes(child), 0);
            }
            return count;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initMindmap();
            console.log('ç®€æ˜“æ€ç»´å¯¼å›¾å·²åˆå§‹åŒ–');
        });
    </script>
</body>
</html> 