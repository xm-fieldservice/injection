<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å½¢å¼ä¸­å¿ƒèŠ‚ç‚¹ç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .test-button {
            background: linear-gradient(45deg, #FF6B6B, #FF8E8E);
            color: white;
            border: none;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .test-button.success {
            background: linear-gradient(45deg, #4ECDC4, #7FDBDA);
        }
        .test-button.error {
            background: linear-gradient(45deg, #FA7272, #F84A4A);
        }
        .result-area {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #4CAF50; }
        .status-error { background: #F44336; }
        .status-warning { background: #FF9800; }
        .title {
            text-align: center;
            font-size: 28px;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid #4ECDC4;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="title">ğŸ§ª å½¢å¼ä¸­å¿ƒèŠ‚ç‚¹ç³»ç»Ÿæµ‹è¯•å·¥å…·</h1>
        
        <div class="test-section">
            <h3>ğŸ“‹ æµ‹è¯•é¡¹ç›®</h3>
            <button class="test-button" onclick="runSimpleTest()">ğŸ§ª ç®€å•æµ‹è¯•</button>
            <button class="test-button" onclick="runDetailedTest()">ğŸ”§ è¯¦ç»†æµ‹è¯•</button>
            <button class="test-button" onclick="runConfigTest()">âš™ï¸ é…ç½®éªŒè¯</button>
            <button class="test-button" onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="testResults" class="result-area">ç­‰å¾…æµ‹è¯•...\nç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•</div>
        </div>

        <div class="test-section">
            <h3>ğŸ” ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h3>
            <div id="systemStatus" class="result-area">ç³»ç»ŸçŠ¶æ€æ£€æŸ¥ä¸­...</div>
        </div>
    </div>

    <script>
        // æµ‹è¯•ç»“æœæ˜¾ç¤ºåŒºåŸŸ
        const resultsArea = document.getElementById('testResults');
        const statusArea = document.getElementById('systemStatus');

        // æ—¥å¿—è¾“å‡ºå‡½æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            const logMessage = `[${timestamp}] ${icon} ${message}\n`;
            resultsArea.textContent += logMessage;
            resultsArea.scrollTop = resultsArea.scrollHeight;
            console.log(logMessage);
        }

        // æ¸…ç©ºç»“æœ
        function clearResults() {
            resultsArea.textContent = 'ç»“æœå·²æ¸…ç©ºï¼Œå‡†å¤‡æ–°çš„æµ‹è¯•...\n';
            statusArea.textContent = 'ç­‰å¾…ç³»ç»ŸçŠ¶æ€æ£€æŸ¥...\n';
        }

        // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        function checkSystemStatus() {
            log('ğŸ” å¼€å§‹æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...', 'info');
            
            const checks = [
                {
                    name: 'jsMindä¸»é¡µé¢è®¿é—®',
                    test: () => {
                        try {
                            // å°è¯•é€šè¿‡iframeæˆ–è€…window.openè®¿é—®ä¸»é¡µé¢
                            return 'skip'; // è·¨åŸŸé—®é¢˜ï¼Œè·³è¿‡æ­¤æ£€æŸ¥
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'æœ¬åœ°å­˜å‚¨å¯ç”¨æ€§',
                    test: () => {
                        try {
                            localStorage.setItem('test', 'value');
                            const result = localStorage.getItem('test') === 'value';
                            localStorage.removeItem('test');
                            return result;
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'Console APIå¯ç”¨æ€§',
                    test: () => typeof console !== 'undefined' && typeof console.log === 'function'
                },
                {
                    name: 'DOMæ“ä½œå¯ç”¨æ€§',
                    test: () => typeof document !== 'undefined' && typeof document.createElement === 'function'
                }
            ];

            let statusReport = 'ğŸ” ç³»ç»ŸçŠ¶æ€æ£€æŸ¥æŠ¥å‘Š:\n\n';
            
            checks.forEach(check => {
                const result = check.test();
                let status, icon;
                
                if (result === 'skip') {
                    status = 'è·³è¿‡';
                    icon = 'â­ï¸';
                } else if (result === true) {
                    status = 'æ­£å¸¸';
                    icon = 'âœ…';
                } else {
                    status = 'å¼‚å¸¸';
                    icon = 'âŒ';
                }
                
                statusReport += `${icon} ${check.name}: ${status}\n`;
            });

            // æ£€æŸ¥localStorageä¸­çš„ç›¸å…³æ•°æ®
            try {
                const virtualCenterData = localStorage.getItem('nodemind_virtual_center_nodes');
                if (virtualCenterData) {
                    const parsedData = JSON.parse(virtualCenterData);
                    statusReport += `\nğŸ’¾ localStorageä¸­çš„å½¢å¼ä¸­å¿ƒèŠ‚ç‚¹æ•°æ®:\n`;
                    statusReport += JSON.stringify(parsedData, null, 2) + '\n';
                } else {
                    statusReport += `\nğŸ’¾ localStorageä¸­æš‚æ— å½¢å¼ä¸­å¿ƒèŠ‚ç‚¹æ•°æ®\n`;
                }
            } catch (e) {
                statusReport += `\nâŒ localStorageæ•°æ®è¯»å–å¤±è´¥: ${e.message}\n`;
            }

            statusArea.textContent = statusReport;
        }

        // ç®€å•æµ‹è¯•
        function runSimpleTest() {
            log('ğŸ§ª å¼€å§‹ç®€å•æµ‹è¯•...', 'info');
            
            // æ¨¡æ‹Ÿç®€å•æµ‹è¯•åœºæ™¯
            const tests = [
                { name: 'åŸºç¡€ç¯å¢ƒæ£€æŸ¥', result: true },
                { name: 'é…ç½®å¯¹è±¡æ¨¡æ‹Ÿ', result: true },
                { name: 'æ•°æ®åº“å¯¹è±¡æ¨¡æ‹Ÿ', result: true },
                { name: 'CSSæ ·å¼æ£€æŸ¥', result: true }
            ];

            tests.forEach((test, index) => {
                setTimeout(() => {
                    if (test.result) {
                        log(`${test.name}: é€šè¿‡`, 'success');
                    } else {
                        log(`${test.name}: å¤±è´¥`, 'error');
                    }
                }, index * 500);
            });

            setTimeout(() => {
                log('ğŸ‰ ç®€å•æµ‹è¯•å®Œæˆï¼', 'success');
            }, tests.length * 500);
        }

        // è¯¦ç»†æµ‹è¯•
        function runDetailedTest() {
            log('ğŸ”§ å¼€å§‹è¯¦ç»†æµ‹è¯•...', 'info');
            
            // æ¨¡æ‹Ÿé…ç½®å¯¹è±¡
            const mockConfig = {
                STORAGE_KEY: 'nodemind_virtual_center_nodes',
                ID_PREFIX: 'virtual_center_',
                HIDE_ROOT_CLASS: 'hide-real-root'
            };

            const mockNodes = {};

            // è¯¦ç»†æµ‹è¯•æ­¥éª¤
            const detailedTests = [
                {
                    name: 'é…ç½®å¯¹è±¡ç»“æ„éªŒè¯',
                    test: () => {
                        return mockConfig.STORAGE_KEY && 
                               mockConfig.ID_PREFIX && 
                               mockConfig.HIDE_ROOT_CLASS;
                    }
                },
                {
                    name: 'è™šæ‹Ÿä¸­å¿ƒèŠ‚ç‚¹æ•°æ®åº“åˆå§‹åŒ–',
                    test: () => {
                        return typeof mockNodes === 'object';
                    }
                },
                {
                    name: 'localStorageäº¤äº’æµ‹è¯•',
                    test: () => {
                        try {
                            const testData = { test: 'virtual_center_test' };
                            localStorage.setItem(mockConfig.STORAGE_KEY, JSON.stringify(testData));
                            const retrieved = JSON.parse(localStorage.getItem(mockConfig.STORAGE_KEY));
                            return retrieved.test === 'virtual_center_test';
                        } catch (e) {
                            return false;
                        }
                    }
                },
                {
                    name: 'IDç”Ÿæˆç®—æ³•æµ‹è¯•',
                    test: () => {
                        const virtualId = mockConfig.ID_PREFIX + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        return virtualId.startsWith(mockConfig.ID_PREFIX) && virtualId.length > mockConfig.ID_PREFIX.length;
                    }
                },
                {
                    name: 'CSSç±»åéªŒè¯',
                    test: () => {
                        return mockConfig.HIDE_ROOT_CLASS === 'hide-real-root';
                    }
                }
            ];

            detailedTests.forEach((test, index) => {
                setTimeout(() => {
                    const result = test.test();
                    if (result) {
                        log(`${test.name}: é€šè¿‡`, 'success');
                    } else {
                        log(`${test.name}: å¤±è´¥`, 'error');
                    }
                }, index * 800);
            });

            setTimeout(() => {
                log('ğŸ“Š è¯¦ç»†æµ‹è¯•æŠ¥å‘Š:', 'info');
                log(`- é…ç½®å¯¹è±¡: ${JSON.stringify(mockConfig)}`, 'info');
                log(`- æµ‹è¯•å®Œæˆæ—¶é—´: ${new Date().toLocaleString()}`, 'info');
                log('ğŸ¯ è¯¦ç»†æµ‹è¯•å®Œæˆï¼', 'success');
            }, detailedTests.length * 800);
        }

        // é…ç½®éªŒè¯æµ‹è¯•
        function runConfigTest() {
            log('âš™ï¸ å¼€å§‹é…ç½®éªŒè¯æµ‹è¯•...', 'info');
            
            // éªŒè¯å¿…è¦çš„é…ç½®é¡¹
            const configChecks = [
                { key: 'STORAGE_KEY', expected: 'nodemind_virtual_center_nodes' },
                { key: 'ID_PREFIX', expected: 'virtual_center_' },
                { key: 'HIDE_ROOT_CLASS', expected: 'hide-real-root' }
            ];

            const mockConfig = {
                STORAGE_KEY: 'nodemind_virtual_center_nodes',
                ID_PREFIX: 'virtual_center_',
                HIDE_ROOT_CLASS: 'hide-real-root'
            };

            configChecks.forEach((check, index) => {
                setTimeout(() => {
                    const actual = mockConfig[check.key];
                    if (actual === check.expected) {
                        log(`${check.key}: "${actual}" âœ“`, 'success');
                    } else {
                        log(`${check.key}: æœŸæœ›"${check.expected}", å®é™…"${actual}" âœ—`, 'error');
                    }
                }, index * 300);
            });

            setTimeout(() => {
                // æ£€æŸ¥localStorageå…¼å®¹æ€§
                try {
                    const testKey = 'virtual_center_test_' + Date.now();
                    const testValue = { test: true, timestamp: Date.now() };
                    
                    localStorage.setItem(testKey, JSON.stringify(testValue));
                    const retrieved = JSON.parse(localStorage.getItem(testKey));
                    localStorage.removeItem(testKey);
                    
                    if (retrieved && retrieved.test === true) {
                        log('LocalStorageå…¼å®¹æ€§: æ­£å¸¸ âœ“', 'success');
                    } else {
                        log('LocalStorageå…¼å®¹æ€§: å¼‚å¸¸ âœ—', 'error');
                    }
                } catch (e) {
                    log(`LocalStorageå…¼å®¹æ€§: é”™è¯¯ - ${e.message} âœ—`, 'error');
                }
                
                log('âš™ï¸ é…ç½®éªŒè¯æµ‹è¯•å®Œæˆï¼', 'success');
            }, configChecks.length * 300 + 500);
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        window.addEventListener('load', function() {
            setTimeout(checkSystemStatus, 1000);
            log('ğŸš€ æµ‹è¯•å·¥å…·å·²åŠ è½½ï¼Œå‡†å¤‡å°±ç»ªï¼', 'success');
        });

        // æ¨¡æ‹ŸjsMindä¸»é¡µé¢æµ‹è¯•
        function simulateMainPageTest() {
            log('ğŸ”— æ¨¡æ‹Ÿä¸»é¡µé¢åŠŸèƒ½æµ‹è¯•...', 'info');
            
            // åˆ›å»ºä¸€ä¸ªéšè—çš„iframeæ¥æµ‹è¯•ä¸»é¡µé¢
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = 'jsmind-local.html';
            
            iframe.onload = function() {
                try {
                    // ç”±äºåŒæºç­–ç•¥ï¼Œè¿™é‡Œå¯èƒ½æ— æ³•ç›´æ¥è®¿é—®iframeå†…å®¹
                    log('ä¸»é¡µé¢åŠ è½½æˆåŠŸï¼ˆiframeæ–¹å¼ï¼‰', 'success');
                    
                    // å°è¯•æ‰§è¡Œæµ‹è¯•
                    setTimeout(() => {
                        // æ¨¡æ‹Ÿæµ‹è¯•ç»“æœ
                        log('æ¨¡æ‹Ÿæµ‹è¯•ç»“æœ:', 'info');
                        log('- VIRTUAL_CENTER_CONFIG: âœ…', 'success');
                        log('- virtualCenterNodes: âœ…', 'success');
                        log('- å½“å‰è„‘å›¾å®ä¾‹: âœ…', 'success');
                        log('- CSSæ ·å¼å·²åŠ è½½: âœ…', 'success');
                    }, 2000);
                    
                } catch (e) {
                    log(`ä¸»é¡µé¢æµ‹è¯•å¤±è´¥: ${e.message}`, 'error');
                }
            };
            
            iframe.onerror = function() {
                log('ä¸»é¡µé¢åŠ è½½å¤±è´¥', 'error');
            };
            
            document.body.appendChild(iframe);
            
            // 3ç§’åç§»é™¤iframe
            setTimeout(() => {
                document.body.removeChild(iframe);
                log('æ¸…ç†æµ‹è¯•iframe', 'info');
            }, 5000);
        }

        // æš´éœ²æµ‹è¯•å‡½æ•°åˆ°æ§åˆ¶å°
        window.testTools = {
            runSimpleTest,
            runDetailedTest,
            runConfigTest,
            simulateMainPageTest,
            clearResults,
            checkSystemStatus
        };

        log('ğŸ› ï¸ æµ‹è¯•å·¥å…·å‡½æ•°å·²æš´éœ²åˆ° window.testTools', 'info');
    </script>
</body>
</html> 